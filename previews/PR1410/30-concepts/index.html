<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Concepts · TulipaEnergyModel.jl</title><meta name="title" content="Concepts · TulipaEnergyModel.jl"/><meta property="og:title" content="Concepts · TulipaEnergyModel.jl"/><meta property="twitter:title" content="Concepts · TulipaEnergyModel.jl"/><meta name="description" content="Documentation for TulipaEnergyModel.jl."/><meta property="og:description" content="Documentation for TulipaEnergyModel.jl."/><meta property="twitter:description" content="Documentation for TulipaEnergyModel.jl."/><meta property="og:url" content="https://TulipaEnergy.github.io/TulipaEnergyModel.jl/30-concepts/"/><meta property="twitter:url" content="https://TulipaEnergy.github.io/TulipaEnergyModel.jl/30-concepts/"/><link rel="canonical" href="https://TulipaEnergy.github.io/TulipaEnergyModel.jl/30-concepts/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="TulipaEnergyModel.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">TulipaEnergyModel.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Welcome</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../10-tutorials/11-setting-up/">Setting up</a></li><li><a class="tocitem" href="../10-tutorials/12-basics/">Tutorial 1: The Basics</a></li><li><a class="tocitem" href="../10-tutorials/13-assets/">Tutorial 2: Assets and Flows</a></li><li><a class="tocitem" href="../10-tutorials/14-fully-flexible-time/">Tutorial 3: Flexible Time Resolution</a></li><li><a class="tocitem" href="../10-tutorials/15-clustering-rep-periods/">Tutorial 4: Representative Periods with Tulipa Clustering</a></li><li><a class="tocitem" href="../10-tutorials/16-storage/">Tutorial 5: Seasonal and Non-seasonal Storage</a></li><li><a class="tocitem" href="../10-tutorials/17-multi-year-investments/">Tutorial 6: Multi-year investments</a></li><li><a class="tocitem" href="../10-tutorials/30-workflow/">Tutorial 7: Workflow</a></li><li><a class="tocitem" href="../10-tutorials/31-rolling-horizon/">Tutorial 8: Rolling Horizon</a></li><li><a class="tocitem" href="../10-tutorials/99-manual-steps/">Advanced Control</a></li></ul></li><li><span class="tocitem">User Guide</span><ul><li><a class="tocitem" href="../20-user-guide/00-getting-started/">Getting Started</a></li><li><a class="tocitem" href="../20-user-guide/20-how-to-use/">How to Use</a></li><li><a class="tocitem" href="../20-user-guide/50-schemas/">Analysis Workflow</a></li><li><a class="tocitem" href="../20-user-guide/55-outputs/">Output Variables</a></li><li><a class="tocitem" href="../20-user-guide/60-structures/">Internal Model Structures</a></li></ul></li><li class="is-active"><a class="tocitem" href>Concepts</a><ul class="internal"><li><a class="tocitem" href="#concepts-summary"><span>Summary</span></a></li><li><a class="tocitem" href="#flex-asset-connection"><span>Flexible Connection of Energy Assets</span></a></li><li><a class="tocitem" href="#flex-time-res"><span>Flexible Time Resolution</span></a></li><li><a class="tocitem" href="#flex-time-res-uc"><span>Flexible Time Resolution in the Unit Commitment and Ramping Constraints</span></a></li><li><a class="tocitem" href="#storage-modeling"><span>Storage Modeling</span></a></li><li><a class="tocitem" href="#flex-time-res-dc-opf"><span>Flexible Time Resolution in the Direct Current Optimal Power Flow Constraints</span></a></li><li><a class="tocitem" href="#flex-time-res-mimo"><span>Flexible Time Resolution in Assets with Multiple Input and Multiple Output (MIMO) and Flows Relationships</span></a></li></ul></li><li><span class="tocitem">Scientific Foundation</span><ul><li><a class="tocitem" href="../40-scientific-foundation/40-formulation/">Mathematical Formulation</a></li><li><a class="tocitem" href="../40-scientific-foundation/45-scientific-references/">Scientific References</a></li></ul></li><li><a class="tocitem" href="../70-reference/">API Reference</a></li><li><a class="tocitem" href="../80-ecosystem/">Tulipa Ecosystem</a></li><li><span class="tocitem">Contributing</span><ul><li><a class="tocitem" href="../90-contributing/90-contributing/">Contributing Guidelines</a></li><li><a class="tocitem" href="../90-contributing/91-developer/">Developer Documentation</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Concepts</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Concepts</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/TulipaEnergy/TulipaEnergyModel.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/TulipaEnergy/TulipaEnergyModel.jl/blob/main/docs/src/30-concepts.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="concepts"><a class="docs-heading-anchor" href="#concepts">Concepts</a><a id="concepts-1"></a><a class="docs-heading-anchor-permalink" href="#concepts" title="Permalink"></a></h1><ul><li><a href="#concepts-summary">Summary</a></li><li><a href="#flex-asset-connection">Flexible Connection of Energy Assets</a></li><li class="no-marker"><ul><li><a href="#Additional-explanation-on-transport-flows">Additional explanation on transport flows</a></li></ul></li><li><a href="#flex-time-res">Flexible Time Resolution</a></li><li class="no-marker"><ul><li><a href="#Energy-Balance-Constraints">Energy Balance Constraints</a></li><li><a href="#Capacity-Constraints">Capacity Constraints</a></li><li><a href="#Storage-Level-limits">Storage Level limits</a></li><li><a href="#comparison">Comparison of Different Modeling Approaches</a></li></ul></li><li><a href="#flex-time-res-uc">Flexible Time Resolution in the Unit Commitment and Ramping Constraints</a></li><li class="no-marker"><ul><li><a href="#Ramping-in-Assets-with-Multiple-Outputs">Ramping in Assets with Multiple Outputs</a></li><li><a href="#Unit-Commitment-in-Assets-with-Constant-Time-Resolution">Unit Commitment in Assets with Constant Time Resolution</a></li><li><a href="#Unit-Commitment-and-Ramping-in-Assets-with-Flexible-Time-Resolution-that-are-Multiples-of-Each-Other">Unit Commitment and Ramping in Assets with Flexible Time Resolution that are Multiples of Each Other</a></li><li><a href="#Unit-Commitment-and-Ramping-in-Assets-with-Flexible-Time-Resolution-that-are-NOT-Multiples-of-Each-Other">Unit Commitment and Ramping in Assets with Flexible Time Resolution that are NOT Multiples of Each Other</a></li><li><a href="#Unit-Commitment-and-Ramping-Case-Study-Results">Unit Commitment and Ramping Case Study Results</a></li></ul></li><li><a href="#storage-modeling">Storage Modeling</a></li><li class="no-marker"><ul><li><a href="#Example-to-Model-Seasonal-and-Non-seasonal-Storage">Example to Model Seasonal and Non-seasonal Storage</a></li></ul></li><li><a href="#flex-time-res-dc-opf">Flexible Time Resolution in the Direct Current Optimal Power Flow Constraints</a></li><li class="no-marker"><ul><li><a href="#The-Core-Model">The Core Model</a></li><li><a href="#Model-Feasibility-Issues">Model Feasibility Issues</a></li></ul></li><li><a href="#flex-time-res-mimo">Flexible Time Resolution in Assets with Multiple Input and Multiple Output (MIMO) and Flows Relationships</a></li><li class="no-marker"><ul><li><a href="#Constraints-for-Flows-Relationships">Constraints for Flows Relationships</a></li><li><a href="#The-Conversion-Coefficient-and-the-Conversion-Balance-Constraints">The Conversion Coefficient and the Conversion Balance Constraints</a></li><li><a href="#The-Capacity-Coefficient-and-the-Maximum-Capacity-Constraints">The Capacity Coefficient and the Maximum Capacity Constraints</a></li><li><a href="#The-Atmosphere-as-a-Consumer-Asset">The Atmosphere as a Consumer Asset</a></li></ul></li></ul><h2 id="concepts-summary"><a class="docs-heading-anchor" href="#concepts-summary">Summary</a><a id="concepts-summary-1"></a><a class="docs-heading-anchor-permalink" href="#concepts-summary" title="Permalink"></a></h2><p><em>TulipaEnergyModel.jl</em> uses two fundamental building blocks as the foundation of the optimization model:</p><ul><li><strong>Assets</strong>: representation of a physical asset that can produce, consume, store, balance, or convert energy. Some examples of what these assets can represent are:<ul><li>Producer: e.g., wind turbine, solar panel</li><li>Consumer: e.g., electricity demand, heat demand</li><li>Storage: e.g., battery, pumped-hydro storage</li><li>Balancing Hub: e.g., an electricity network that serves as a connection among other energy assets</li><li>Conversion: e.g., power plants, electrolyzers</li></ul></li><li><strong>Flows</strong>: representation of the connections among assets, e.g., pipelines, transmission lines, or simply the energy production that goes from one asset to another.</li></ul><p>In a nutshell, the model guarantees a balance of energy for the various types of assets while considering the flow limits. It considers a set of <a href="../20-user-guide/60-structures/#representative-periods">representative periods</a> (e.g., days or weeks) for a given <a href="../20-user-guide/60-structures/#timeframe">timeframe</a> (e.g., a year) the user wants to analyze. Therefore, the model has two types of temporal (time) constraints to consider the different chronology characteristics of the assets:</p><ul><li><strong>Rep-period Constraints</strong>: These constraints limit the asset or flow within a representative period. The rep-period constraints help to characterize the short-term operational dynamics of the assets. So far, the model considers balance and flow limitations within the representative period, as well as unit commitment and ramping. In the future, reserve constraints will also be included.</li><li><strong>Over-clustered-year Constraints</strong>: These constraints combine the information of the representative periods and create limitations between them to recover chronological information across the whole timeframe. The over-clustered-year constraints help to characterize the long-term operational dynamics of the assets (e.g., seasonality). So far, the model uses this type of constraint to model seasonal storage. Future developments will include, for example, maximum or minimum production/consumption for a year (or any timeframe).</li></ul><div class="admonition is-info" id="Are-you-into-the-math,-objective-function-terms,-and-constraints?-bef3ea3bea6858b"><header class="admonition-header">Are you into the math, objective function terms, and constraints?<a class="admonition-anchor" href="#Are-you-into-the-math,-objective-function-terms,-and-constraints?-bef3ea3bea6858b" title="Permalink"></a></header><div class="admonition-body"><p>The <a href="../40-scientific-foundation/40-formulation/#formulation"><code>mathematical formulation</code></a> shows an overview of all the constraints and the variables in the model.</p></div></div><p>Another essential concept in the model is the <a href="#flex-time-res">flexible time resolution</a>, which allows for each asset to be considered in a single timestep (e.g., 1, 2, 3...) or in a range of timesteps (e.g., 1:3, meaning that the asset&#39;s variable represents the value of timesteps 1, 2, and 3). This concept allows the modeling of different dynamics depending on the asset; for instance, electricity assets can be modeled hourly, whereas hydrogen assets can be modeled in a 6-hour resolution (avoiding creating unnecessary constraints and variables).</p><p>The following sections explain these concepts in more detail.</p><div class="admonition is-info" id="Want-to-know-more-about-the-references-used-in-this-section?-755e5c1781db7aae"><header class="admonition-header">Want to know more about the references used in this section?<a class="admonition-anchor" href="#Want-to-know-more-about-the-references-used-in-this-section?-755e5c1781db7aae" title="Permalink"></a></header><div class="admonition-body"><p>Please visit the <a href="../40-scientific-foundation/45-scientific-references/#scientific-refs">scientific references</a> section for links to the papers that support this section.</p></div></div><h2 id="flex-asset-connection"><a class="docs-heading-anchor" href="#flex-asset-connection">Flexible Connection of Energy Assets</a><a id="flex-asset-connection-1"></a><a class="docs-heading-anchor-permalink" href="#flex-asset-connection" title="Permalink"></a></h2><p>In energy system modeling, it is becoming common to have hybrid assets like <code>storage + renewable</code> (e.g., battery + solar), <code>electrolyzer + renewable</code> (e.g., electrolyzer + wind), or <code>renewable + hydro</code> (e.g., solar + hydro) that are located at the same site and share a common connection point to the grid. The standard method of modeling these assets requires extra variables and constraints for them to function correctly. For example, flows from the grid are not allowed, as they either avoid charging from the grid or require green hydrogen production. Therefore, hybrid connections typically require an additional node to regulate this connection with the grid.</p><p>The representation of the energy system in <em>TulipaEnergyModel.jl</em> is based on <a href="https://en.wikipedia.org/wiki/Graph_theory">Graph Theory</a>, which deals with the connection between vertices by edges. This representation provides a more flexible framework to model energy <em>assets</em> in the system as <em>vertices</em> and <em>flows</em> between energy assets as <em>edges</em>. By connecting assets directly to each other (i.e., without having a node in between), we reduce the number of variables and constraints needed to represent hybrid configurations, thus reducing the model size.</p><p>Consider the following example to demonstrate the benefits of using a graph theory approach. In the classic connection approach, the nodes play a crucial role in modeling. For instance, every asset must be connected to a node with balance constraints. When a storage asset and a renewable asset are in a hybrid connection like the one described before, a connection point is needed to connect the hybrid configuration to the rest of the system. Therefore, to consider the hybrid configuration of a storage asset and a renewable asset, we must introduce a node (i.e., a connection point) between these assets and the external power grid (i.e., a balance point), as shown in the following figure:</p><p><img src="../figs/flexible-connection-1.png" alt="Classic connection"/></p><p>In this system, the <code>phs</code> storage asset charges and discharges from the <code>connection point</code>, while the <code>wind</code> turbine produces power that goes directly to the <code>connection point</code>. This <code>connection point</code> is connected to the external power grid through a transmission line that leads to a <code>balance</code> hub that connects to other assets. Essentially, the <code>connection point</code> acts as a balancing hub point for the assets in this hybrid configuration. Furthermore, these hybrid configurations impose an extra constraint to avoid storage charges from the power grid.</p><p>Let&#39;s consider the modeling approach in <em>TulipaEnergyModel.jl</em>. As nodes are no longer needed to connect assets, we can connect them directly to each other, as shown in the figure below:</p><p><img src="../figs/flexible-connection-2.png" alt="Flexible connection"/></p><p>By implementing this approach, we can reduce the number of variables and constraints involved. For example, the balance constraint in the intermediate node and the extra constraint to avoid the storage charging from the power grid are no longer needed. Additionally, we can eliminate the variable determining the flow between the intermediate node and the power grid, because the flow from <code>phs</code> to <code>balance</code> can directly link to the external grid. The section <a href="#comparison"><code>comparison of different modeling approaches</code></a> shows the quantification of these reductions.</p><p>This example of a <code>phs</code> and a <code>wind</code> asset is useful for illustrating the advantages of this modeling approach and will be reused in the following sections. However, please keep in mind that there are other applications of hybrid configurations, such as battery-solar, hydro-solar, and electrolyzer-wind.</p><h3 id="Additional-explanation-on-transport-flows"><a class="docs-heading-anchor" href="#Additional-explanation-on-transport-flows">Additional explanation on transport flows</a><a id="Additional-explanation-on-transport-flows-1"></a><a class="docs-heading-anchor-permalink" href="#Additional-explanation-on-transport-flows" title="Permalink"></a></h3><p>In <em>TulipaEnergyModel.jl</em>, flows can be both input/output flows and transport flows (i.e., where you model a transmission asset). In the above illustrative example, <code>wind-balance</code> is an energy output flow, representing the production from <code>wind</code> directly sent to <code>balance</code>. In this case, the flow has a direction from <code>wind</code> to <code>balance</code>. However, in principle, any flow can be a transport flow and by definition in <em>TulipaEnergyModel.jl</em>, transport flows are bidirectional.</p><p>Let&#39;s zoom in on the <code>phs-wind-balance</code> triangle and see what happens in the figure below. To the left, all three flows have transformed into transport flows, and they are now bidirectional. Flows can go towards <code>wind</code>, which can be counter-intuitive: what does it mean to have a producer receiving energy? Translating into a standard method may help the thinking, we are essentially modeling the case to the right. The producer cannot receive energy, but transport flows can pass through an extra node with a unidirectional flow from the producer. We reduce this unnecessary node, but the modeling problem is not changed.</p><p><img src="../figs/flexible-connection-3.png" alt="Flexible connection with transport flows"/></p><div class="admonition is-warning" id="Be-careful-with-the-definition-of-flows-74b1f8af13d9116a"><header class="admonition-header">Be careful with the definition of flows<a class="admonition-anchor" href="#Be-careful-with-the-definition-of-flows-74b1f8af13d9116a" title="Permalink"></a></header><div class="admonition-body"><ol><li>Although transport flows are bidirectional, they must be defined in a single direction. For example, a producer like wind can only have outgoing flows. Thus, the flow between <code>wind</code> and <code>balance</code> must be specified as the flow from <code>wind</code> to <code>balance</code>, with its sign allowed to be free.</li><li>By having transport flows, we now model a different problem because flows can pass through <code>wind</code> following the direction from <code>balance</code> to <code>wind</code> to <code>phs</code>. <code>wind</code> is essentially a hub asset. However, this does not affect the unidirectional nature of charging by the flow from <code>wind</code> to <code>phs</code> and discharging by the flow from <code>phs</code> to <code>balance</code>, which remain fixed by the definition of the flows.</li></ol></div></div><h2 id="flex-time-res"><a class="docs-heading-anchor" href="#flex-time-res">Flexible Time Resolution</a><a id="flex-time-res-1"></a><a class="docs-heading-anchor-permalink" href="#flex-time-res" title="Permalink"></a></h2><p>One of the core features of <em>TulipaEnergyModel.jl</em> is that it can handle different time resolutions on the assets and the flows. Typically, the time resolution in an energy model is hourly, like in the following figure where we have a 6-hour energy system:</p><p><img src="../figs/variable-time-resolution-1.png" alt="Hourly Time Resolution"/></p><p>Therefore, for this simple example, we can determine the number of constraints and variables in the optimization problem:</p><ul><li><p><em>Number of variables</em>: 42 since we have six connections among assets (i.e., 6 flows x 6 hours = 36 variables) and one storage asset (i.e., 1 storage level x 6 h = 6 variables)</p></li><li><p><em>Number of constraints</em>: 72, which are:</p><ul><li>24 from the maximum output limit of the assets that produce, convert, or discharge energy (i.e., <code>H2</code>, <code>wind</code>, <code>ccgt</code>, and <code>phs</code>) for each hour (i.e., 4 assets x 6 h = 24 constraints)</li><li>6 from the maximum input limit of the storage or charging limit for the <code>phs</code></li><li>6 from the maximum storage level limit for the <code>phs</code></li><li>12 from the import and export limits for the transmission line between the <code>balance</code> hub and the <code>demand</code></li><li>24 from the energy balance on the consumer, hub, conversion, and storage assets (i.e., <code>demand</code>, <code>balance</code>, <code>ccgt</code>, and <code>phs</code>) for each hour (i.e., 4 assets x 6 h = 24 constraints)</li></ul></li></ul><p>Depending on the input data and the level of detail you want to model, hourly resolution in all the variables might not be necessary. <em>TulipaEnergyModel.jl</em> can have different time resolutions for each asset and flow to simplify the optimization problem and approximate hourly representation. This feature is useful for large-scale energy systems that involve multiple sectors, as detailed granularity is not always necessary due to the unique temporal dynamics of each sector. For instance, we can use hourly resolution for the electricity sector and six-hour resolution for the hydrogen sector. We can couple multiple sectors, each with its own temporal resolution.</p><p>Let&#39;s explore the flexibility of time resolution with a few examples.</p><p>The following table shows the user input data for the definition of asset time resolution. Please note that the values presented in this example are just for illustrative purposes and do not represent a realistic case.</p><div><div style = "float: left;"><span>2×5 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">asset</th><th style = "text-align: left;">year</th><th style = "text-align: left;">rep_period</th><th style = "text-align: left;">specification</th><th style = "text-align: left;">partition</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "InlineStrings.String7" style = "text-align: left;">String7</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "InlineStrings.String7" style = "text-align: left;">String7</th><th title = "Int64" style = "text-align: left;">Int64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">H2</td><td style = "text-align: right;">2030</td><td style = "text-align: right;">1</td><td style = "text-align: left;">uniform</td><td style = "text-align: right;">6</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">phs</td><td style = "text-align: right;">2030</td><td style = "text-align: right;">1</td><td style = "text-align: left;">uniform</td><td style = "text-align: right;">6</td></tr></tbody></table></div><p>The table shows that the <code>H2</code> producer and the <code>phs</code> storage have a <code>uniform</code> definition of 6 hours. This definition means we want to represent the <code>H2</code> production profile and the storage level of the <code>phs</code> every six hours.</p><p>The same time resolution can be specified for the flows, for example (again, the values are for illustrative purposes and do not represent a realistic case):</p><div><div style = "float: left;"><span>5×6 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">from_asset</th><th style = "text-align: left;">to_asset</th><th style = "text-align: left;">year</th><th style = "text-align: left;">rep_period</th><th style = "text-align: left;">specification</th><th style = "text-align: left;">partition</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "InlineStrings.String7" style = "text-align: left;">String7</th><th title = "InlineStrings.String7" style = "text-align: left;">String7</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "InlineStrings.String7" style = "text-align: left;">String7</th><th title = "InlineStrings.String7" style = "text-align: left;">String7</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">H2</td><td style = "text-align: left;">ccgt</td><td style = "text-align: right;">2030</td><td style = "text-align: right;">1</td><td style = "text-align: left;">uniform</td><td style = "text-align: left;">6</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">wind</td><td style = "text-align: left;">balance</td><td style = "text-align: right;">2030</td><td style = "text-align: right;">1</td><td style = "text-align: left;">math</td><td style = "text-align: left;">1x2+1x4</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: left;">wind</td><td style = "text-align: left;">phs</td><td style = "text-align: right;">2030</td><td style = "text-align: right;">1</td><td style = "text-align: left;">uniform</td><td style = "text-align: left;">3</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: left;">phs</td><td style = "text-align: left;">balance</td><td style = "text-align: right;">2030</td><td style = "text-align: right;">1</td><td style = "text-align: left;">math</td><td style = "text-align: left;">1x4+1x2</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: left;">balance</td><td style = "text-align: left;">demand</td><td style = "text-align: right;">2030</td><td style = "text-align: right;">1</td><td style = "text-align: left;">uniform</td><td style = "text-align: left;">3</td></tr></tbody></table></div><p>The table shows a <code>uniform</code> definition for the flow from the hydrogen producer (<code>H2</code>) to the conversion asset (<code>ccgt</code>) of 6 hours, from the wind producer (<code>wind</code>) to the storage (<code>phs</code>) of 3 hours, and from the balance hub (<code>balance</code>) to the consumer (<code>demand</code>) of 3 hours, too. In addition, the flow from the wind producer (<code>wind</code>) to the balance hub (<code>balance</code>) is defined using the <code>math</code> specification of <code>1x2+1x4</code>, meaning that there are two time blocks, one of two hours (i.e., <code>1:2</code>) and another of four hours (i.e., <code>3:6</code>). Finally, the flow from the storage (<code>phs</code>) to the balance hub (<code>balance</code>) is defined using the <code>math</code> specification of <code>1x4+1x2</code>, meaning that there are two time blocks, one of four hours (i.e., <code>1:4</code>) and another of two hours (i.e., <code>5:6</code>).</p><p>The following figure illustrates these definitions on the example system.</p><p><img src="../figs/variable-time-resolution-2.png" alt="Variable Time Resolution"/></p><p>So, let&#39;s recap:</p><ul><li>The hydrogen producer (<code>H2</code>) is in a 6-hour resolution represented by the range <code>1:6</code>, meaning that the balance of the hydrogen produced is for every 6 hours.</li><li>The flow from the hydrogen producer to the ccgt power plant (<code>H2,ccgt</code>) is also in a 6-hour resolution <code>1:6</code>.</li><li>The flow from the ccgt power plant to the balance hub (<code>ccgt, balance</code>) has hourly resolution <code>[1,2,3,4,5,6]</code>.</li><li>The <code>ccgt</code> is a conversion plant that takes hydrogen to produce electricity. Since both sectors have different time resolutions, the energy balance in the conversion asset is defined in the lowest resolution connecting to the asset. In this case, the energy balance in the <code>ccgt</code> is defined every 6 hours, i.e., in the range <code>1:6</code>.</li><li>The <code>wind</code> producer has an hourly profile of electricity production, so the resolution of the asset is hourly.</li><li>The <code>wind</code> producer output has two connections, one to the <code>balance</code> hub and the other to the pumped-hydro storage (<code>phs</code>) with different resolutions:<ul><li>The flow from the wind producer to the phs storage (<code>wind, phs</code>) has a uniform resolution of two blocks from hours 1 to 3 (i.e., <code>1:3</code>) and from hours 4 to 6 (i.e., <code>4:6</code>).</li><li>The flow from the wind producer to the balance hub (<code>wind, balance</code>) has a variable resolution of two blocks, too, but from hours 1 to 2 (i.e., <code>1:2</code>) and from hours 3 to 6 (i.e., <code>3:6</code>).</li></ul></li><li>The <code>phs</code> is in a 6-hour resolution represented by the range <code>1:6</code>, meaning the storage balance is determined every 6 hours.</li><li>The flow from the phs to the balance (<code>phs, balance</code>) represents the discharge of the <code>phs</code>. This flow has a variable resolution of two blocks from hours 1 to 4 (i.e., <code>1:4</code>) and from hours 5 to 6 (i.e., <code>5:6</code>), which differs from the one defined for the charging flow from the <code>wind</code> asset.</li><li>The <code>demand</code> consumption has hourly input data with one connection to the <code>balance</code> hub:<ul><li>The flow from the balance hub to the demand (<code>balance, demand</code>) has a uniform resolution of 3 hours; therefore, it has two blocks, one from hours 1 to 3 (i.e., <code>1:3</code>) and the other from hours 4 to 6 (i.e., <code>4:6</code>).</li></ul></li><li>The <code>balance</code> hub integrates all the different assets with their different resolutions. The lowest resolution of all connections determines the balance equation for this asset. Therefore, the resulting resolution is into two blocks, one from hours 1 to 4 (i.e., <code>1:4</code>) and the other from hours 5 to 6 (i.e., <code>5:6</code>).</li></ul><div class="admonition is-success" id="Fully-flexible-temporal-resolution-de64bff463c798c3"><header class="admonition-header">Fully flexible temporal resolution<a class="admonition-anchor" href="#Fully-flexible-temporal-resolution-de64bff463c798c3" title="Permalink"></a></header><div class="admonition-body"><p>This example demonstrates that different time resolutions can be assigned to each asset and flow in the model. Furthermore, the resolutions do not need to be multiples of one another or evenly distributed and they can vary throughout the time horizon.</p></div></div><p>The complete input data for this example can be found in the <a href="https://github.com/TulipaEnergy/TulipaEnergyModel.jl/tree/main/test/inputs/Variable%20Resolution">variable resolution example</a>.</p><p>Due to the flexible resolution, we must explicitly state how the constraints are constructed. For each constraint, three things need to be considered:</p><ul><li>Whether it is type <em>power</em> or type <em>energy</em>.<ul><li>type <em>power</em>: highest resolution</li><li>type <em>energy</em>: lowest resolution (multiplied by durations)</li></ul></li><li>How the resolution is determined (regardless of whether it is highest or lowest): the incoming flows, the outgoing flows, or a combination of both.</li><li>How the related parameters are treated. We use two methods of aggregation, <em>sum</em> or <em>mean</em>.</li></ul><p>Below is the table outlining the details for each type of constraint.</p><div class="admonition is-success" id="Before-reading-the-table-consider-this:-1acb8835f639471a"><header class="admonition-header">Before reading the table consider this:<a class="admonition-anchor" href="#Before-reading-the-table-consider-this:-1acb8835f639471a" title="Permalink"></a></header><div class="admonition-body"><p>To calculte the resolution of the constraints we use the <code>min</code> function to determine which is the highest resolution in the constraint, and the <code>max</code> function to determine the lowest resolution in the constraint. For example, the consumer balance is defined as <code>power</code> type, and it involves the inputs and outputs, then the constraint resolution must be the minimum resolution among them to ensure it is on the <code>highest resolution</code>. Then, if you have an input of <code>1h</code> resolution and an output of <code>2h</code> resolution; then the resolution of the constraint must be <code>1h</code> (i.e., <code>min(1h,2h)</code>).</p></div></div><table><tr><th style="text-align: right">Name</th><th style="text-align: right">Variables involved</th><th style="text-align: right">Profile involved</th><th style="text-align: right">Constraint type</th><th style="text-align: right">Resolution of the constraints</th><th style="text-align: right">Profile aggregation</th></tr><tr><td style="text-align: right">Consumer Balance</td><td style="text-align: right">inputs, outputs</td><td style="text-align: right">demand</td><td style="text-align: right">power</td><td style="text-align: right">min(incoming flows, outgoing flows)</td><td style="text-align: right">mean</td></tr><tr><td style="text-align: right">Storage Balance</td><td style="text-align: right">inputs, outputs, storage level</td><td style="text-align: right">inflows</td><td style="text-align: right">energy</td><td style="text-align: right">max(asset, min(incoming flows, outgoing flows))</td><td style="text-align: right">sum</td></tr><tr><td style="text-align: right">Hub Balance</td><td style="text-align: right">inputs, outputs</td><td style="text-align: right">-</td><td style="text-align: right">power</td><td style="text-align: right">min(incoming flows, outgoing flows)</td><td style="text-align: right">-</td></tr><tr><td style="text-align: right">Conversion Balance</td><td style="text-align: right">inputs, outputs <sup class="footnote-reference"><a id="citeref-1" href="#footnote-1" class="footnote-ref">[1]</a><span class="footnote-preview" id="fn-1"></span></sup></td><td style="text-align: right">-</td><td style="text-align: right">energy</td><td style="text-align: right">max(incoming flows, outgoing flows)</td><td style="text-align: right">-</td></tr><tr><td style="text-align: right">Producers Capacity Constraints</td><td style="text-align: right">outputs</td><td style="text-align: right">availability</td><td style="text-align: right">power</td><td style="text-align: right">min(outgoing flows)</td><td style="text-align: right">mean</td></tr><tr><td style="text-align: right">Storage Capacity Constraints (outgoing)</td><td style="text-align: right">outputs</td><td style="text-align: right">-</td><td style="text-align: right">power</td><td style="text-align: right">min(outgoing flows)</td><td style="text-align: right">-</td></tr><tr><td style="text-align: right">Conversion Capacity Constraints (outgoing)</td><td style="text-align: right">outputs</td><td style="text-align: right">-</td><td style="text-align: right">power</td><td style="text-align: right">min(outgoing flows)</td><td style="text-align: right">-</td></tr><tr><td style="text-align: right">Conversion Capacity Constraints (incoming)</td><td style="text-align: right">inputs</td><td style="text-align: right">-</td><td style="text-align: right">power</td><td style="text-align: right">min(incoming flows)</td><td style="text-align: right">-</td></tr><tr><td style="text-align: right">Storage Capacity Constraints (incoming)</td><td style="text-align: right">inputs</td><td style="text-align: right">-</td><td style="text-align: right">power</td><td style="text-align: right">min(incoming flows)</td><td style="text-align: right">-</td></tr><tr><td style="text-align: right">Transport Capacity Constraints (upper bounds)</td><td style="text-align: right">flow</td><td style="text-align: right">availability</td><td style="text-align: right">power</td><td style="text-align: right">if it connects two hubs or demands then max(hub a,hub b), otherwise its own</td><td style="text-align: right">mean</td></tr><tr><td style="text-align: right">Transport Capacity Constraints (lower bounds)</td><td style="text-align: right">flow</td><td style="text-align: right">availability</td><td style="text-align: right">power</td><td style="text-align: right">if it connects two hubs or demands then max(hub a,hub b), otherwise its own</td><td style="text-align: right">mean</td></tr><tr><td style="text-align: right">Maximum Energy Limits (outgoing)</td><td style="text-align: right">outputs</td><td style="text-align: right">max_energy</td><td style="text-align: right">energy</td><td style="text-align: right">Determine by timeframe partitions. The default value is for each period in the timeframe</td><td style="text-align: right">sum</td></tr><tr><td style="text-align: right">Minimum Energy Limits (outgoing)</td><td style="text-align: right">outputs</td><td style="text-align: right">min_energy</td><td style="text-align: right">energy</td><td style="text-align: right">Determine by timeframe partitions. The default value is for each period in the timeframe</td><td style="text-align: right">sum</td></tr><tr><td style="text-align: right">Maximum Output Flow with Unit Commitment</td><td style="text-align: right">outputs, units_on</td><td style="text-align: right">availability</td><td style="text-align: right">power</td><td style="text-align: right">min(outgoing flows, units_on)</td><td style="text-align: right">mean</td></tr><tr><td style="text-align: right">Minimum Output Flow with Unit Commitment</td><td style="text-align: right">outputs, units_on</td><td style="text-align: right">availability</td><td style="text-align: right">power</td><td style="text-align: right">min(outgoing flows, units_on)</td><td style="text-align: right">mean</td></tr><tr><td style="text-align: right">Maximum Ramp Up Flow with Unit Commitment</td><td style="text-align: right">outputs, units_on</td><td style="text-align: right">availability</td><td style="text-align: right">power</td><td style="text-align: right">min(outgoing flows, units_on)</td><td style="text-align: right">mean</td></tr><tr><td style="text-align: right">Maximum Ramp Down Flow with Unit Commitment</td><td style="text-align: right">outputs, units_on</td><td style="text-align: right">availability</td><td style="text-align: right">power</td><td style="text-align: right">min(outgoing flows, units_on)</td><td style="text-align: right">mean</td></tr><tr><td style="text-align: right">Maximum Ramp Up Flow without Unit Commitment</td><td style="text-align: right">outputs</td><td style="text-align: right">availability</td><td style="text-align: right">power</td><td style="text-align: right">min(outgoing flows)</td><td style="text-align: right">mean</td></tr><tr><td style="text-align: right">Maximum Ramp Down Flow without Unit Commitment</td><td style="text-align: right">outputs</td><td style="text-align: right">availability</td><td style="text-align: right">power</td><td style="text-align: right">min(outgoing flows)</td><td style="text-align: right">mean</td></tr><tr><td style="text-align: right">DC-OPF Constraint</td><td style="text-align: right">flow, electricity_angle</td><td style="text-align: right">-</td><td style="text-align: right">power</td><td style="text-align: right">min(neighboring assets, flow)</td><td style="text-align: right">-</td></tr><tr><td style="text-align: right">Flows relationships</td><td style="text-align: right">flow 1, flow 2</td><td style="text-align: right">-</td><td style="text-align: right">energy</td><td style="text-align: right">max(flow1, flow2)</td><td style="text-align: right">-</td></tr></table><p>For this basic example, we can describe the balance and capacity constraints in the model. For the sake of simplicity, we consider only the rep-period constraints, the representative period index is dropped from the equations, and there are no investment variables in the equations.</p><h3 id="Energy-Balance-Constraints"><a class="docs-heading-anchor" href="#Energy-Balance-Constraints">Energy Balance Constraints</a><a id="Energy-Balance-Constraints-1"></a><a class="docs-heading-anchor-permalink" href="#Energy-Balance-Constraints" title="Permalink"></a></h3><p>In the following sections, we lay out all the balance constraints of this example.</p><h4 id="Storage-Balance"><a class="docs-heading-anchor" href="#Storage-Balance">Storage Balance</a><a id="Storage-Balance-1"></a><a class="docs-heading-anchor-permalink" href="#Storage-Balance" title="Permalink"></a></h4><p>As shown in the table, the resolution of the storage balance is energy, which is calculated by <em>max(asset, min(incoming flows, outgoing flows))</em>. The resolutions of the incoming and outgoing flows of the storage are <code>1:3</code>, <code>4:6</code>, <code>1:4</code>, and <code>5:6</code>, resulting in a minimum resolution of 2. The resolution of the storage is 6. Then, <em>max(asset, min(incoming flows, outgoing flows))</em> becomes <em>max(6, min(3, (4, 2)))</em> which results in 6, and thus this balance is for every 6 hours. The charging and discharging flows are multiplied by their durations to account for the energy in the range <code>1:6</code>.</p><p class="math-container">\[\begin{aligned}
&amp; \text{storage\_balance}_{\text{phs},1:6}: \\
&amp; \qquad v^{\text{rep-period-storage}}_{\text{phs},1:6} = 3 \cdot p^{\text{eff}}_{(\text{wind},\text{phs})} \cdot v^{\text{flow}}_{(\text{wind},\text{phs}),1:3} + 3 \cdot p^{\text{eff}}_{(\text{wind},\text{phs})} \cdot v^{\text{flow}}_{(\text{wind},\text{phs}),4:6} \\
&amp; \qquad \quad - \frac{4}{p^{\text{eff}}_{(\text{phs},\text{balance})}} \cdot v^{\text{flow}}_{(\text{phs},\text{balance}),1:4} - \frac{2}{p^{\text{eff}}_{(\text{phs},\text{balance})}} \cdot v^{\text{flow}}_{(\text{phs},\text{balance}),5:6} \\
\end{aligned}\]</p><h4 id="Consumer-Balance"><a class="docs-heading-anchor" href="#Consumer-Balance">Consumer Balance</a><a id="Consumer-Balance-1"></a><a class="docs-heading-anchor-permalink" href="#Consumer-Balance" title="Permalink"></a></h4><p>The flows coming from the balancing hub are defined every 3 hours. Then, <em>min(incoming flows, outgoing flows)</em> becomes <em>min(3, -) = 3</em>, and thus balanced every 3 hours. The input demand is aggregated as the mean of the hourly values in the input data.</p><p class="math-container">\[\begin{aligned}
&amp; \text{consumer\_balance}_{\text{demand},1:3}: \\
&amp; \qquad v^{\text{flow}}_{(\text{balance},\text{demand}),1:3} = p^{\text{peak demand}}_{\text{demand}} \cdot \frac{\sum_{b=1}^{3} p^{\text{demand profile}}_{\text{demand},b}}{3} \\
&amp; \text{consumer\_balance}_{\text{demand},4:6}: \\
&amp; \qquad v^{\text{flow}}_{(\text{balance},\text{demand}),4:6} = p^{\text{peak demand}}_{\text{demand}} \cdot \frac{\sum_{b=4}^{6} p^{\text{demand profile}}_{\text{demand},b}}{3} \\
\end{aligned}\]</p><h4 id="Hub-Balance"><a class="docs-heading-anchor" href="#Hub-Balance">Hub Balance</a><a id="Hub-Balance-1"></a><a class="docs-heading-anchor-permalink" href="#Hub-Balance" title="Permalink"></a></h4><p>The hub balance is quite interesting because it integrates several flow resolutions. Remember that we didn&#39;t define any specific time resolution for this asset. Therefore, the highest resolution of all incoming and outgoing flows in the horizon implies that the hub balance must be imposed for all 6 blocks since <em>min(incoming flows, outgoing flows)</em> becomes <em>min(1,2,3,4) = 1</em></p><p class="math-container">\[\begin{aligned}
&amp; \text{hub\_balance}_{\text{balance},1:1}: \\
&amp; \qquad v^{\text{flow}}_{(\text{balance},\text{demand}),1:3} = v^{\text{flow}}_{(\text{ccgt},\text{balance}), 1:1} + v^{\text{flow}}_{(\text{wind},\text{balance}),1:2} + v^{\text{flow}}_{(\text{phs},\text{balance}),1:4} \\
&amp; \text{hub\_balance}_{\text{balance},2:2}: \\
&amp; \qquad v^{\text{flow}}_{(\text{balance},\text{demand}),1:3} = v^{\text{flow}}_{(\text{ccgt},\text{balance}), 2:2} + v^{\text{flow}}_{(\text{wind},\text{balance}),1:2} + v^{\text{flow}}_{(\text{phs},\text{balance}),1:4} \\
&amp; \text{hub\_balance}_{\text{balance},3:3}: \\
&amp; \qquad v^{\text{flow}}_{(\text{balance},\text{demand}),1:3} = v^{\text{flow}}_{(\text{ccgt},\text{balance}), 3:3} + v^{\text{flow}}_{(\text{wind},\text{balance}),3:6} + v^{\text{flow}}_{(\text{phs},\text{balance}),1:4} \\
&amp; \text{hub\_balance}_{\text{balance},4:4}: \\
&amp; \qquad v^{\text{flow}}_{(\text{balance},\text{demand}),4:6} = v^{\text{flow}}_{(\text{ccgt},\text{balance}), 4:4} + v^{\text{flow}}_{(\text{wind},\text{balance}),3:6} + v^{\text{flow}}_{(\text{phs},\text{balance}),1:4}\\
&amp; \text{hub\_balance}_{\text{balance},5:5}: \\
&amp; \qquad v^{\text{flow}}_{(\text{balance},\text{demand}),4:6} = v^{\text{flow}}_{(\text{ccgt},\text{balance}), 5:5} + v^{\text{flow}}_{(\text{wind},\text{balance}),3:6} + v^{\text{flow}}_{(\text{phs},\text{balance}),5:6} \\
&amp; \text{hub\_balance}_{\text{balance},6:6}: \\
&amp; \qquad v^{\text{flow}}_{(\text{balance},\text{demand}),4:6} = v^{\text{flow}}_{(\text{ccgt},\text{balance}), 6:6} + v^{\text{flow}}_{(\text{wind},\text{balance}),3:6} + v^{\text{flow}}_{(\text{phs},\text{balance}),5:6} \\
\end{aligned}\]</p><h4 id="Conversion-Balance"><a class="docs-heading-anchor" href="#Conversion-Balance">Conversion Balance</a><a id="Conversion-Balance-1"></a><a class="docs-heading-anchor-permalink" href="#Conversion-Balance" title="Permalink"></a></h4><p>The flows connected to the CCGT conversion unit have different resolutions, too. In this case, the hydrogen imposes the lowest resolution; therefore, the energy balance in this asset is also every 6 hours.</p><p class="math-container">\[\begin{aligned}
&amp; \text{conversion\_balance}_{\text{ccgt},1:6}: \\
&amp; \qquad 6 \cdot p^{\text{eff}}_{(\text{H2},\text{ccgt})} \cdot v^{\text{flow}}_{(\text{H2},\text{ccgt}),1:6} = \frac{1}{p^{\text{eff}}_{(\text{ccgt},\text{balance})}} \sum_{b=1}^{6} v^{\text{flow}}_{(\text{ccgt},\text{balance}),b}  \\
\end{aligned}\]</p><h3 id="Capacity-Constraints"><a class="docs-heading-anchor" href="#Capacity-Constraints">Capacity Constraints</a><a id="Capacity-Constraints-1"></a><a class="docs-heading-anchor-permalink" href="#Capacity-Constraints" title="Permalink"></a></h3><p>All capacity constraints are defined in the highest resolution to guarantee that the flows are below the limits of each asset capacity.</p><h4 id="Storage-Capacity-Constraints"><a class="docs-heading-anchor" href="#Storage-Capacity-Constraints">Storage Capacity Constraints</a><a id="Storage-Capacity-Constraints-1"></a><a class="docs-heading-anchor-permalink" href="#Storage-Capacity-Constraints" title="Permalink"></a></h4><p>Since the storage unit only has one input and output, the capacity limit constraints are in the same resolution as the individual flows. Therefore, the constraints for the outputs of the storage (i.e., discharging capacity limit) are:</p><p class="math-container">\[\begin{aligned}
&amp; \text{max\_output\_flows\_limit}_{\text{phs},1:4}: \\
&amp; \qquad v^{\text{flow}}_{(\text{phs},\text{balance}),1:4} \leq p^{\text{init capacity}}_{\text{phs}} \\
&amp; \text{max\_output\_flows\_limit}_{\text{phs},5:6}: \\
&amp; \qquad v^{\text{flow}}_{(\text{phs},\text{balance}),5:6} \leq p^{\text{init capacity}}_{\text{phs}} \\
\end{aligned}\]</p><p>And the constraints for the inputs of the storage (i.e., charging capacity limit) are:</p><p class="math-container">\[\begin{aligned}
&amp; \text{max\_input\_flows\_limit}_{\text{phs},1:3}: \\
&amp; \qquad v^{\text{flow}}_{(\text{wind},\text{phs}),1:3} \leq p^{\text{init capacity}}_{\text{phs}} \\
&amp; \text{max\_input\_flows\_limit}_{\text{phs},4:6}: \\
&amp; \qquad v^{\text{flow}}_{(\text{wind},\text{phs}),4:6} \leq p^{\text{init capacity}}_{\text{phs}} \\
\end{aligned}\]</p><h4 id="Conversion-Capacity-Constraints"><a class="docs-heading-anchor" href="#Conversion-Capacity-Constraints">Conversion Capacity Constraints</a><a id="Conversion-Capacity-Constraints-1"></a><a class="docs-heading-anchor-permalink" href="#Conversion-Capacity-Constraints" title="Permalink"></a></h4><p>Similarly, each outflow is limited to the <code>ccgt</code> capacity for the conversion unit.</p><p class="math-container">\[\begin{aligned}
&amp; \text{max\_output\_flows\_limit}_{\text{ccgt},b}: \\
&amp; \qquad v^{\text{flow}}_{(\text{ccgt},\text{balance}),b} \leq p^{\text{init capacity}}_{\text{ccgt}} \quad \forall b \in [1,6] \\
\end{aligned}\]</p><h4 id="Producer-Capacity-Constraints"><a class="docs-heading-anchor" href="#Producer-Capacity-Constraints">Producer Capacity Constraints</a><a id="Producer-Capacity-Constraints-1"></a><a class="docs-heading-anchor-permalink" href="#Producer-Capacity-Constraints" title="Permalink"></a></h4><p>The <code>wind</code> producer asset is interesting because the output flows are in different resolutions, i.e., <code>1:2</code>, <code>3:6</code>, <code>1:3</code>, and <code>4:6</code>. The highest resolution is <code>1:2</code>, <code>3</code>, and <code>4:6</code>. Therefore, the constraints are as follows:</p><p class="math-container">\[\begin{aligned}
&amp; \text{max\_output\_flows\_limit}_{\text{wind},1:2}: \\
&amp; \qquad v^{\text{flow}}_{(\text{wind},\text{balance}),1:2} + v^{\text{flow}}_{(\text{wind},\text{phs}),1:3} \leq \frac{p^{\text{init capacity}}_{\text{wind}}}{2} \cdot \sum_{b=1}^{2} p^{\text{availability profile}}_{\text{wind},b} \\
&amp; \text{max\_output\_flows\_limit}_{\text{wind},3}: \\
&amp; \qquad v^{\text{flow}}_{(\text{wind},\text{balance}),3:6} + v^{\text{flow}}_{(\text{wind},\text{phs}),1:3} \leq p^{\text{init capacity}}_{\text{wind}} \cdot p^{\text{availability profile}}_{\text{wind},3} \\
&amp; \text{max\_output\_flows\_limit}_{\text{wind},4:6}: \\
&amp; \qquad v^{\text{flow}}_{(\text{wind},\text{balance}),3:6} + v^{\text{flow}}_{(\text{wind},\text{phs}),4:6} \leq \frac{p^{\text{init capacity}}_{\text{wind}}}{3} \cdot \sum_{b=4}^{6} p^{\text{availability profile}}_{\text{wind},b} \\
\end{aligned}\]</p><p>Since the flow variables <span>$v^{\text{flow}}_{(\text{wind}, \text{balance}),1:2}$</span> and <span>$v^{\text{flow}}_{(\text{wind}, \text{balance}),1:3}$</span> represent power, the first constraint sets the upper bound of the power for both timestep 1 and 2, by assuming an average capacity across these two timesteps. The same applies to the other two constraints.</p><p>The hydrogen (H2) producer capacity limit is straightforward, since both the asset and the flow definitions are in the same time resolution:</p><p class="math-container">\[\begin{aligned}
&amp; \text{max\_output\_flows\_limit}_{\text{H2},1:6}: \\
&amp; \qquad v^{\text{flow}}_{(\text{H2},\text{ccgt}),1:6} \leq p^{\text{init capacity}}_{\text{H2}} \cdot p^{\text{availability profile}}_{\text{H2},1:6} \\
\end{aligned}\]</p><h4 id="Transport-Capacity-Constraints"><a class="docs-heading-anchor" href="#Transport-Capacity-Constraints">Transport Capacity Constraints</a><a id="Transport-Capacity-Constraints-1"></a><a class="docs-heading-anchor-permalink" href="#Transport-Capacity-Constraints" title="Permalink"></a></h4><p>For the connection from the hub to the demand, there are associated transmission capacity constraints, which are in the same resolution as the flow:</p><p class="math-container">\[\begin{aligned}
&amp; \text{max\_transport\_flows\_limit}_{(\text{balance},\text{demand}),1:3}: \\
&amp; \qquad v^{\text{flow}}_{(\text{balance},\text{demand}),1:3} \leq p^{\text{init export capacity}}_{(\text{balance},\text{demand})} \\
&amp; \text{max\_transport\_flows\_limit}_{(\text{balance},\text{demand}),4:6}: \\
&amp; \qquad v^{\text{flow}}_{(\text{balance},\text{demand}),4:6} \leq p^{\text{init export capacity}}_{(\text{balance},\text{demand})} \\
\end{aligned}\]</p><p class="math-container">\[\begin{aligned}
&amp; \text{min\_transport\_flows\_limit}_{(\text{balance},\text{demand}),1:3}: \\
&amp; \qquad v^{\text{flow}}_{(\text{balance},\text{demand}),1:3} \geq - p^{\text{init import capacity}}_{(\text{balance},\text{demand})} \\
&amp; \text{min\_transport\_flows\_limit}_{(\text{balance},\text{demand}),4:6}: \\
&amp; \qquad v^{\text{flow}}_{(\text{balance},\text{demand}),4:6} \geq - p^{\text{init import capacity}}_{(\text{balance},\text{demand})} \\
\end{aligned}\]</p><h3 id="Storage-Level-limits"><a class="docs-heading-anchor" href="#Storage-Level-limits">Storage Level limits</a><a id="Storage-Level-limits-1"></a><a class="docs-heading-anchor-permalink" href="#Storage-Level-limits" title="Permalink"></a></h3><p>Since the system has a storage asset, we must limit the maximum storage level. The <code>phs</code> time resolution is defined for every 6 hours, so we only have one constraint.</p><p class="math-container">\[\begin{aligned}
&amp; \text{max\_storage\_level\_limit}_{\text{phs},1:6}: \\
&amp; \qquad v^{\text{rep-period-storage}}_{\text{phs},1:6} \leq p^{\text{init storage capacity}}_{\text{phs}}
\end{aligned}\]</p><h3 id="comparison"><a class="docs-heading-anchor" href="#comparison">Comparison of Different Modeling Approaches</a><a id="comparison-1"></a><a class="docs-heading-anchor-permalink" href="#comparison" title="Permalink"></a></h3><p>This section quantifies the advantages of the <a href="#flex-asset-connection"><code>flexible connection</code></a> and <a href="#flex-time-res"><code>flexible time resolution</code></a> in the <em>TulipaEnergyModel.jl</em> modeling approach. So, let us consider three different approaches based on the same example:</p><ol><li>Classic approach with hourly resolution: This approach needs an extra asset, <code>node</code>, to create the hybrid operation of the <code>phs</code> and <code>wind</code> assets.</li><li>Flexible connection with hourly resolution: This approach uses the flexible connection to represent the hybrid operation of the <code>phs</code> and <code>wind</code> assets.</li><li>Flexible connection and flexible time: This approach uses both features, the flexible connection and the flexible time resolution.</li></ol><div class="admonition is-success" id="Tip-ec2d861365b266b6"><header class="admonition-header">Tip<a class="admonition-anchor" href="#Tip-ec2d861365b266b6" title="Permalink"></a></header><div class="admonition-body"><p>The flexibility of <em>TulipaEnergyModel.jl</em> allows any of these three modeling approaches.</p></div></div><p>The table below shows the constraints and variables for each approach over a 6-hour horizon. These results show the potential of flexible connections and time resolution for reducing the size of the optimization model.</p><table><tr><th style="text-align: left">Modeling approach</th><th style="text-align: left">Nº Variables</th><th style="text-align: left">Nº Constraints</th><th style="text-align: left">Objective Function</th></tr><tr><td style="text-align: left">Classic approach with hourly resolution</td><td style="text-align: left">48</td><td style="text-align: left">84</td><td style="text-align: left">28.4365</td></tr><tr><td style="text-align: left">Flexible connection with hourly resolution</td><td style="text-align: left">42</td><td style="text-align: left">72</td><td style="text-align: left">28.4365</td></tr><tr><td style="text-align: left">Flexible connection and time resolution</td><td style="text-align: left">16</td><td style="text-align: left">29</td><td style="text-align: left">28.4587</td></tr></table><p>By comparing the classic approach with the other methods, we can analyze their differences:</p><ul><li>The flexible connection with hourly resolution reduces 6 variables (<span>$12.5\%$</span>) and 12 constraints (<span>$\approx 14\%$</span>). Notice that we include the 6 extra constraints related to not allowing charging from the grid, although these constraints can also be modeled as bounds. Finally, the objective function value is the same, since we use an hourly time resolution in both cases.</li><li>The combination of features reduces 32 variables (<span>$\approx 67\%$</span>) and 55 constraints (<span>$\approx 65\%$</span>) with an approximation error of <span>$\approx 0.073\%$</span>.</li></ul><p>The level of reduction and approximation error will depend on the case study. Some cases that would benefit from this feature include:</p><ul><li><p>Coupling different energy sectors with various dynamics. For instance, methane, hydrogen, and heat sectors can be represented in energy models with lower resolutions (e.g., 4, 6, or 12h) than the electricity sector, usually modeled in higher resolutions (e.g., 1h, 30 min).</p></li><li><p>Having high resolutions for all assets in a large-scale case study may not be necessary. For example, if analyzing a European case study focusing on a specific country like The Netherlands, hourly details for distant countries (such as Portugal and Spain) may not be required. However, one would still want to consider their effect on The Netherlands without causing too much computational burden. In such cases, flexible time resolution can maintain hourly details in the focus country, while reducing the detail in distant countries by increasing their resolution (to two hours or more). This reduction allows a broader scope without over-burdening computation.</p></li></ul><h2 id="flex-time-res-uc"><a class="docs-heading-anchor" href="#flex-time-res-uc">Flexible Time Resolution in the Unit Commitment and Ramping Constraints</a><a id="flex-time-res-uc-1"></a><a class="docs-heading-anchor-permalink" href="#flex-time-res-uc" title="Permalink"></a></h2><p>In the previous section, we have seen how the flexible temporal resolution is handled for the model&#39;s flow capacity and balance constraints. Here, we show how flexible time resolution is applied when considering the model&#39;s unit commitment and ramping constraints. Let&#39;s consider the example in the folder <a href="https://github.com/TulipaEnergy/TulipaEnergyModel.jl/tree/main/test/inputs/UC-ramping"><code>test/inputs/UC-ramping</code></a> to explain how all these constraints are created in <em>TulipaEnergyModel.jl</em> when having the flexible time resolution.</p><p><img src="../figs/unit-commitment-case-study.png" alt="unit-commitment-case-study"/></p><p>The example demonstrates various assets that supply demand. Each asset has different input data files, which activates different sets of constraints based on the method. For example, the <code>gas</code> producer has ramping constraints but not unit commitment constraints, while the <code>ocgt</code> conversion has unit commitment constraints but not ramping constraints. Lastly, the <code>ccgt</code> and <code>smr</code> assets both have unit commitment and ramping constraints. Moreover, <code>ccgt</code>, <code>wind</code>, <code>solar</code>, and <code>ocgt</code> are investable, meaning that the investment variable will only appear on the constraints related to those assets.</p><div><div style = "float: left;"><span>7×9 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">asset</th><th style = "text-align: left;">type</th><th style = "text-align: left;">capacity</th><th style = "text-align: left;">initial_units</th><th style = "text-align: left;">investable</th><th style = "text-align: left;">unit_commitment</th><th style = "text-align: left;">ramping</th><th style = "text-align: left;">max_ramp_up</th><th style = "text-align: left;">max_ramp_down</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "InlineStrings.String7" style = "text-align: left;">String7</th><th title = "InlineStrings.String15" style = "text-align: left;">String15</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Union{Missing, Float64}" style = "text-align: left;">Float64?</th><th title = "Union{Missing, Bool}" style = "text-align: left;">Bool?</th><th title = "Bool" style = "text-align: left;">Bool</th><th title = "Bool" style = "text-align: left;">Bool</th><th title = "Union{Missing, Float64}" style = "text-align: left;">Float64?</th><th title = "Union{Missing, Float64}" style = "text-align: left;">Float64?</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">ccgt</td><td style = "text-align: left;">conversion</td><td style = "text-align: right;">200.0</td><td style = "text-align: right;">1.0</td><td style = "text-align: right;">true</td><td style = "text-align: right;">true</td><td style = "text-align: right;">true</td><td style = "text-align: right;">0.3</td><td style = "text-align: right;">0.4</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">wind</td><td style = "text-align: left;">producer</td><td style = "text-align: right;">100.0</td><td style = "text-align: right;">0.0</td><td style = "text-align: right;">true</td><td style = "text-align: right;">false</td><td style = "text-align: right;">false</td><td style = "font-style: italic; text-align: right;">missing</td><td style = "font-style: italic; text-align: right;">missing</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: left;">solar</td><td style = "text-align: left;">producer</td><td style = "text-align: right;">50.0</td><td style = "text-align: right;">0.0</td><td style = "text-align: right;">true</td><td style = "text-align: right;">false</td><td style = "text-align: right;">false</td><td style = "font-style: italic; text-align: right;">missing</td><td style = "font-style: italic; text-align: right;">missing</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: left;">smr</td><td style = "text-align: left;">producer</td><td style = "text-align: right;">200.0</td><td style = "text-align: right;">1.0</td><td style = "text-align: right;">false</td><td style = "text-align: right;">true</td><td style = "text-align: right;">true</td><td style = "text-align: right;">0.1</td><td style = "text-align: right;">0.1</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: left;">gas</td><td style = "text-align: left;">producer</td><td style = "text-align: right;">1800.0</td><td style = "text-align: right;">1.0</td><td style = "text-align: right;">false</td><td style = "text-align: right;">false</td><td style = "text-align: right;">true</td><td style = "text-align: right;">0.83</td><td style = "text-align: right;">0.83</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">6</td><td style = "text-align: left;">ocgt</td><td style = "text-align: left;">conversion</td><td style = "text-align: right;">100.0</td><td style = "text-align: right;">0.0</td><td style = "text-align: right;">true</td><td style = "text-align: right;">true</td><td style = "text-align: right;">false</td><td style = "font-style: italic; text-align: right;">missing</td><td style = "font-style: italic; text-align: right;">missing</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">7</td><td style = "text-align: left;">ens</td><td style = "text-align: left;">producer</td><td style = "text-align: right;">1150.0</td><td style = "text-align: right;">1.0</td><td style = "text-align: right;">false</td><td style = "text-align: right;">false</td><td style = "text-align: right;">false</td><td style = "font-style: italic; text-align: right;">missing</td><td style = "font-style: italic; text-align: right;">missing</td></tr></tbody></table></div><p>The <code>assets-rep-periods-partitions</code> file defines the time resolution for the assets in the <code>partition</code> column. For instance, here we can see that the time resolutions are 3h for the <code>ccgt</code> and 6h for the <code>smr</code>. These values mean that the unit commitment variables (e.g., <code>units_on</code>) in the model have three and six hours resolution, respectively.</p><div><div style = "float: left;"><span>2×3 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">asset</th><th style = "text-align: left;">specification</th><th style = "text-align: left;">partition</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "InlineStrings.String7" style = "text-align: left;">String7</th><th title = "InlineStrings.String7" style = "text-align: left;">String7</th><th title = "Int64" style = "text-align: left;">Int64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">ccgt</td><td style = "text-align: left;">uniform</td><td style = "text-align: right;">3</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">smr</td><td style = "text-align: left;">uniform</td><td style = "text-align: right;">6</td></tr></tbody></table></div><p>The <code>flows-rep-periods-partitions</code> file defines the time resolution for the flows. In this example, we have that the flows from the <code>gas</code> asset to the <code>ccgt</code> and from the <code>ccgt</code> asset to the <code>demand</code> are in a 2h resolution.</p><div><div style = "float: left;"><span>2×4 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">from_asset</th><th style = "text-align: left;">to_asset</th><th style = "text-align: left;">specification</th><th style = "text-align: left;">partition</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "InlineStrings.String7" style = "text-align: left;">String7</th><th title = "InlineStrings.String7" style = "text-align: left;">String7</th><th title = "InlineStrings.String7" style = "text-align: left;">String7</th><th title = "Int64" style = "text-align: left;">Int64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">gas</td><td style = "text-align: left;">ccgt</td><td style = "text-align: left;">uniform</td><td style = "text-align: right;">2</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">ccgt</td><td style = "text-align: left;">demand</td><td style = "text-align: left;">uniform</td><td style = "text-align: right;">2</td></tr></tbody></table></div><p>The default value for the assets and flows partitions is 1 hour. This means that assets and flows not in the previous tables are considered on an hourly basis in the model.</p><div class="admonition is-warning" id="Not-every-combination-of-resolutions-is-viable-1c12a4f5cb98db93"><header class="admonition-header">Not every combination of resolutions is viable<a class="admonition-anchor" href="#Not-every-combination-of-resolutions-is-viable-1c12a4f5cb98db93" title="Permalink"></a></header><div class="admonition-body"><p>It&#39;s not recommended to set up the input data <code>partitions</code> in such a way that the <code>flow</code> variables have a lower resolution than the <code>units_on</code>. This is because doing so will result in constraints that fix the value of the <code>units_on</code> in the timestep block where the <code>flow</code> is defined, leading to unnecessary extra variable constraints in the model. For instance, if the <code>units_on</code> are hourly and the <code>flow</code> is every two hours, then a non-zero <code>flow</code> in the timestep block 1:2 will require the <code>units_on</code> in timestep blocks 1:1 and 2:2 to be the same and equal to one. Therefore, the time resolution of the <code>units_on</code> should always be lower than or equal to the resolution of the <code>flow</code> in the asset.</p></div></div><p>Remember that the section <a href="../40-scientific-foundation/40-formulation/#formulation"><code>mathematical formulation</code></a> shows the unit commitment and ramping constraints in the model considering an uniform time resolution as a reference.</p><p>With this information, we can analyze the constraints in each of the following cases:</p><ul><li>Ramping in assets with multiple outputs</li><li>Unit commitment in assets with constant time resolution</li><li>Unit commitment and ramping in assets with flexible time resolution that are multiples of each other</li><li>Unit commitment and ramping in assets with flexible time resolution that are not multiples of each other</li></ul><p>We will analyze each case in the following sections, considering the constraints resolution defined in the summary table in the <a href="#flex-time-res">flexible time resolution</a> section. For the sake of simplicity, we only show the asset <span>$a$</span> and timestep block <span>$b_k$</span> index and the constraints as they appear in the .lp file of the example, i.e., with all the coefficients and RHS values calculated from the input parameters. The .lp file can be exported using the keyword argument <code>model_file_name = &quot;model.lp&quot;</code> in the <a href="../70-reference/#TulipaEnergyModel.run_scenario-Tuple{Any}"><code>run_scenario</code></a> function.</p><h3 id="Ramping-in-Assets-with-Multiple-Outputs"><a class="docs-heading-anchor" href="#Ramping-in-Assets-with-Multiple-Outputs">Ramping in Assets with Multiple Outputs</a><a id="Ramping-in-Assets-with-Multiple-Outputs-1"></a><a class="docs-heading-anchor-permalink" href="#Ramping-in-Assets-with-Multiple-Outputs" title="Permalink"></a></h3><p>In the case of the <code>gas</code> asset, there are two output flows above the minimum operating point with different time resolutions. The ramping constraints follow the highest time resolution of the two flows at each timestep block. Since the highest resolution is always defined by the hourly output of the <span>$v^{\text{flow}}_{(\text{gas,ocgt}),b_k}$</span>, the ramping constraints are also hourly. The figure below illustrates this situation.</p><p><img src="../figs/unit-commitment-gas.png" alt="unit-commitment-gas-asset"/></p><p>Let&#39;s now take a look at the resulting constraints in the model.</p><p><code>max_ramp_up(gas)</code>: The first constraint considers the ramping up of output flows of the gas asset from the first hour to the second (<span>$b_{k = 2:2}$</span> to <span>$b_{k = 1:1}$</span>). Note that since the <span>$v^{\text{flow}}_{(\text{gas,ccgt}),b_k}$</span> is defined in in blocks of 2 hours, we only need to consider the difference of the <span>$v^{\text{flow}}_{(\text{gas,ocgt}),b_k}$</span> variable in this constraint. However, the second constraint takes the difference between the output flows from <span>$b_{k = 3:3}$</span> to <span>$b_{k = 2:2}$</span>. For this constraint, we need to consider the difference in both <span>$v^{\text{flow}}_{(\text{gas,ocgt}),b_k}$</span> and <span>$v^{\text{flow}}_{(\text{gas,ccgt}),b_k}$</span>.</p><div class="admonition is-info" id="Info-51898d86fe783032"><header class="admonition-header">Info<a class="admonition-anchor" href="#Info-51898d86fe783032" title="Permalink"></a></header><div class="admonition-body"><p>The duration parameter in the right hand side (RHS) of this constraint, <span>$\text{RHS} = p^{\text{capacity}}_{\text{gas}} \cdot p^{\text{max ramp up}}_{\text{gas}} \cdot p^{\text{duration}}_{b_k}$</span>, is defined by the flow duration with the <code>highest resolution</code>, i.e., one hour, which is the duration of the <span>$v^{\text{flow}}_{(\text{gas,ocgt}),b_k}$</span>. We need to multiply by duration since the ramp input values are given as rates, i.e., <code>p.u./h</code> or <code>p.u./min</code>, so the RHS in the constraint must be multiplied by the duration to match the flow units. So, using the data for this example we have: <span>$\text{RHS} = 1800 \text{MW} \cdot 0.83 \text{p.u./h} \cdot 1 \text{h} = 1494 \text{MW}$</span></p></div></div><p class="math-container">\[\begin{aligned}
&amp; b_{k = 2:2}: - v^{\text{flow}}_{(\text{gas,ocgt}),1:1} + v^{\text{flow}}_{(\text{gas,ocgt}),2:2} \leq 1494 \\
&amp; b_{k = 3:3}: - v^{\text{flow}}_{(\text{gas,ocgt}),2:2} + v^{\text{flow}}_{(\text{gas,ocgt}),3:3} - v^{\text{flow}}_{(\text{gas,ccgt}),1:2} + v^{\text{flow}}_{(\text{gas,ccgt}),3:4} \leq 1494 \\
&amp; ...
\end{aligned}\]</p><p>For the maximum ramp down we have similiar constraints as the ones shown above.</p><h3 id="Unit-Commitment-in-Assets-with-Constant-Time-Resolution"><a class="docs-heading-anchor" href="#Unit-Commitment-in-Assets-with-Constant-Time-Resolution">Unit Commitment in Assets with Constant Time Resolution</a><a id="Unit-Commitment-in-Assets-with-Constant-Time-Resolution-1"></a><a class="docs-heading-anchor-permalink" href="#Unit-Commitment-in-Assets-with-Constant-Time-Resolution" title="Permalink"></a></h3><p>The <code>ocgt</code> asset includes both the <span>$v^{\text{flow}}_{(\text{ocgt,demand}),b_k}$</span> and the asset time resolution, which defines the resolution of the <code>units_on</code> variable, with a default setting of one hour. As a result, the unit commitment constraints are also set on an hourly basis. This is the conventional method for representing these types of constraints in power system models. The figure below illustrates this situation.</p><p><img src="../figs/unit-commitment-ocgt.png" alt="unit-commitment-ocgt-asset"/></p><p>Let&#39;s now take a look at the resulting constraints in the model. Because everything is based on an hourly timestep, the equations are simple and easy to understand.</p><p><code>limit_units_on(ocgt)</code>: The upper bound of the <code>units_on</code> is the investment variable of the <code>asset</code></p><p class="math-container">\[\begin{aligned}
&amp; b_{k = 1:1}: v^{\text{units on}}_{\text{ocgt},1:1} \leq v^{\text{inv}}_{\text{ocgt}} \\
&amp; b_{k = 2:2}: v^{\text{units on}}_{\text{ocgt},2:2} \leq v^{\text{inv}}_{\text{ocgt}} \\
&amp; ...
\end{aligned}\]</p><p><code>min_output_flow(ocgt)</code>: The minimum operating point is 10 MW, so the asset must produce an output flow greater than this value when the unit is online.</p><p class="math-container">\[\begin{aligned}
&amp; b_{k = 1:1}: v^{\text{flow}}_{(\text{ocgt,demand}),1:1} \geq 10 \cdot v^{\text{units on}}_{\text{ocgt},1:1}  \\
&amp; b_{k = 2:2}: v^{\text{flow}}_{(\text{ocgt,demand}),2:2} \geq 10 \cdot v^{\text{units on}}_{\text{ocgt},2:2}  \\
&amp; ...
\end{aligned}\]</p><p><code>max_output_flow(ocgt)</code>: The capacity is 100 MW, so the asset must produce an output flow lower than this value when the unit is online.</p><p class="math-container">\[\begin{aligned}
&amp; b_{k = 1:1}: v^{\text{flow}}_{(\text{ocgt,demand}),1:1} \leq 100 \cdot v^{\text{units on}}_{\text{ocgt},1:1} \\
&amp; b_{k = 2:2}: v^{\text{flow}}_{(\text{ocgt,demand}),2:2} \leq 100 \cdot v^{\text{units on}}_{\text{ocgt},2:2} \\
&amp; ...
\end{aligned}\]</p><p>For the maximum ramp down we have similiar constraints as the ones shown above.</p><h3 id="Unit-Commitment-and-Ramping-in-Assets-with-Flexible-Time-Resolution-that-are-Multiples-of-Each-Other"><a class="docs-heading-anchor" href="#Unit-Commitment-and-Ramping-in-Assets-with-Flexible-Time-Resolution-that-are-Multiples-of-Each-Other">Unit Commitment and Ramping in Assets with Flexible Time Resolution that are Multiples of Each Other</a><a id="Unit-Commitment-and-Ramping-in-Assets-with-Flexible-Time-Resolution-that-are-Multiples-of-Each-Other-1"></a><a class="docs-heading-anchor-permalink" href="#Unit-Commitment-and-Ramping-in-Assets-with-Flexible-Time-Resolution-that-are-Multiples-of-Each-Other" title="Permalink"></a></h3><p>In this case, the <code>smr</code> asset has an output <span>$v^{\text{flow}}_{(\text{smr,demand}),b_k}$</span> in a hourly basis, but its time resolution (i.e., partition) is every six hours. Therefore, the <code>unist_on</code> variables are defined in timestep block of every six hours. As a result, the unit commitment and ramping constraints are set on highest resolution of both, i.e., the hourly resolution of the <span>$v^{\text{flow}}_{(\text{smr,demand}),b_k}$</span>. The figure below illustrates this situation.</p><p><img src="../figs/unit-commitment-smr.png" alt="unit-commitment-smr-asset"/></p><p>Let&#39;s now take a look at the resulting constraints in the model.</p><p><code>limit_units_on(smr)</code>: The <code>units_on</code> variables are defined every 6h; therefore, the upper bound of the variable is also every 6h. In addition, the <code>smr</code> is not investable and has one existing unit that limits the commitment variables.</p><p class="math-container">\[\begin{aligned}
&amp; b_{k = 1:6}:  v^{\text{units on}}_{\text{smr},1:6}  \leq 1 \\
&amp; b_{k = 7:12}: v^{\text{units on}}_{\text{smr},7:12} \leq 1 \\
&amp; ...
\end{aligned}\]</p><p><code>min_output_flow(smr)</code>: The minimum operating point is 150 MW, so the asset must produce an output flow greater than this value when the unit is online. Since the <code>units_on</code> variables are defined every 6h, the first six constraints show that the minimum operating point is multiplied by the variable in block <code>1:6</code>. The next six constraints are multiplied by the <code>units_on</code> in block <code>7:12</code>, and so on.</p><p class="math-container">\[\begin{aligned}
&amp; b_{k = 1:1}: v^{\text{flow}}_{(\text{smr,demand}),1:1} \geq 150 \cdot v^{\text{units on}}_{\text{smr},1:6} \\
&amp; b_{k = 2:2}: v^{\text{flow}}_{(\text{smr,demand}),2:2} \geq 150 \cdot v^{\text{units on}}_{\text{smr},1:6} \\
&amp; ... \\
&amp; b_{k = 6:6}: v^{\text{flow}}_{(\text{smr,demand}),6:6} \geq 150 \cdot v^{\text{units on}}_{\text{smr},1:6}  \\
&amp; b_{k = 7:7}: v^{\text{flow}}_{(\text{smr,demand}),7:7} \geq 150 \cdot v^{\text{units on}}_{\text{smr},7:12} \\
&amp; ...
\end{aligned}\]</p><p><code>max_output_flow(smr)</code>: The capacity is 200 MW, so the asset must produce an output flow lower than this value when the unit is online. Similiar to the minimum operating point constraint, here the <code>units_on</code> for the timestep block <code>1:6</code> are used in the first six constraints, the <code>units_on</code> for the timestep block <code>7:12</code> are used in the next six constraints, and so on.</p><p class="math-container">\[\begin{aligned}
&amp; b_{k = 1:1}: v^{\text{flow}}_{(\text{smr,demand}),1:1} \leq 200 \cdot v^{\text{units on}}_{\text{smr},1:6}  \\
&amp; b_{k = 2:2}: v^{\text{flow}}_{(\text{smr,demand}),2:2} \leq 200 \cdot v^{\text{units on}}_{\text{smr},1:6}  \\
&amp; ... \\
&amp; b_{k = 6:6}: v^{\text{flow}}_{(\text{smr,demand}),6:6} \leq 200 \cdot v^{\text{units on}}_{\text{smr},1:6}  \\
&amp; b_{k = 7:7}: v^{\text{flow}}_{(\text{smr,demand}),7:7} \leq 200 \cdot v^{\text{units on}}_{\text{smr},7:12} \\
&amp; ...
\end{aligned}\]</p><p><code>max_ramp_up(smr)</code>: The ramping capacity is 20MW, so the change in the output flow above the minimum operating point needs to be below that value when the asset is online. For constraints from <code>2:2</code> to <code>6:6</code>, the <code>units_on</code> variable is the same, i.e., <code>units_on</code> at timestep block <code>1:6</code>. The ramping constraint at timestep block <code>7:7</code> shows the <code>units_on</code> from the timestep block <code>1:6</code> and <code>7:12</code> since the change in the flow includes both variables. Note that if the <code>units_on</code> variable is zero in the timestep block <code>1:6</code>, then the ramping constraint at timestep block <code>7:7</code> allows the asset to go from zero flow to the minimum operating point plus the ramping capacity (i.e., 150 + 20 = 170).</p><p class="math-container">\[\begin{aligned}
&amp; b_{k = 2:2}: - v^{\text{flow}}_{(\text{smr,demand}),1:1} + v^{\text{flow}}_{(\text{smr,demand}),2:2} \leq 20 \cdot v^{\text{units on}}_{\text{smr},1:6} \\
&amp; b_{k = 3:3}: - v^{\text{flow}}_{(\text{smr,demand}),2:2} + v^{\text{flow}}_{(\text{smr,demand}),3:3} \leq 20 \cdot v^{\text{units on}}_{\text{smr},1:6} \\
&amp; ... \\
&amp; b_{k = 6:6}: - v^{\text{flow}}_{(\text{smr,demand}),5:5} + v^{\text{flow}}_{(\text{smr,demand}),6:6} \leq 20 \cdot v^{\text{units on}}_{\text{smr},1:6} \\
&amp; b_{k = 7:7}: - v^{\text{flow}}_{(\text{smr,demand}),6:6} + v^{\text{flow}}_{(\text{smr,demand}),7:7} \leq - 150 \cdot v^{\text{units on}}_{\text{smr},1:6} + 170 \cdot v^{\text{units on}}_{\text{smr},7:12} \\
&amp; b_{k = 8:8}: - v^{\text{flow}}_{(\text{smr,demand}),7:7} + v^{\text{flow}}_{(\text{smr,demand}),8:8} \leq 20 \cdot v^{\text{units on}}_{\text{smr},7:12} \\
&amp; ...
\end{aligned}\]</p><p>For the maximum ramp down we have similiar constraints as the ones shown above.</p><h3 id="Unit-Commitment-and-Ramping-in-Assets-with-Flexible-Time-Resolution-that-are-NOT-Multiples-of-Each-Other"><a class="docs-heading-anchor" href="#Unit-Commitment-and-Ramping-in-Assets-with-Flexible-Time-Resolution-that-are-NOT-Multiples-of-Each-Other">Unit Commitment and Ramping in Assets with Flexible Time Resolution that are NOT Multiples of Each Other</a><a id="Unit-Commitment-and-Ramping-in-Assets-with-Flexible-Time-Resolution-that-are-NOT-Multiples-of-Each-Other-1"></a><a class="docs-heading-anchor-permalink" href="#Unit-Commitment-and-Ramping-in-Assets-with-Flexible-Time-Resolution-that-are-NOT-Multiples-of-Each-Other" title="Permalink"></a></h3><p>In this case, the <code>ccgt</code> asset has an output <span>$v^{\text{flow}}_{(\text{ccgt,demand}),b_k}$</span> on a two-hour basis, but its time resolution (i.e., partition) is every three hours. Therefore, the <code>unist_on</code> variables are defined in a timestep block every three hours. This setup means that the flow and unit commitment variables are not multiples of each other. As a result, the unit commitment and ramping constraints are defined on the highest resolution, meaning that we also need the intersections of both resolutions. The figure below illustrates this situation.</p><p><img src="../figs/unit-commitment-ccgt.png" alt="unit-commitment-ccgt-asset"/></p><p>Let&#39;s now take a look at the resulting constraints in the model.</p><p><code>limit_units_on(ccgt)</code>: The <code>units_on</code> variables are defined every 3h; therefore, the upper bound of the variable is also every 3h. In addition, the <code>ccgt</code> is investable and has one existing unit that limits the commitment variables.</p><p class="math-container">\[\begin{aligned}
&amp;  b_{k = 1:3}:  v^{\text{units on}}_{\text{ccgt},1:3} \leq 1 + v^{\text{inv}}_{\text{ccgt}} \\
&amp;  b_{k = 4:6}:  v^{\text{units on}}_{\text{ccgt},4:6} \leq 1 + v^{\text{inv}}_{\text{ccgt}} \\
&amp; ...
\end{aligned}\]</p><p><code>min_output_flow(ccgt)</code>: The minimum operating point is 50 MW, so the asset must produce an output flow greater than this value when the unit is online. Here, we can see the impact of the constraints of having different temporal resolutions that are not multiples of each other. For instance, the constraint is defined for all the intersections, so <code>1:2</code>, <code>3:3</code>, <code>4:4</code>, <code>5:6</code>, etc., to ensure that the minimum operating point is correctly defined considering all the timestep blocks of the <code>flow</code> and the <code>units_on</code> variables.</p><p class="math-container">\[\begin{aligned}
&amp; b_{k = 1:2}: v^{\text{flow}}_{(\text{ccgt,demand}),1:2} \geq 50 \cdot v^{\text{units on}}_{\text{ccgt},1:3} \\
&amp; b_{k = 3:3}: v^{\text{flow}}_{(\text{ccgt,demand}),3:4} \geq 50 \cdot v^{\text{units on}}_{\text{ccgt},1:3} \\
&amp; b_{k = 4:4}: v^{\text{flow}}_{(\text{ccgt,demand}),3:4} \geq 50 \cdot v^{\text{units on}}_{\text{ccgt},4:6} \\
&amp; b_{k = 5:6}: v^{\text{flow}}_{(\text{ccgt,demand}),5:6} \geq 50 \cdot v^{\text{units on}}_{\text{ccgt},4:6} \\
&amp; ...
\end{aligned}\]</p><p><code>max_output_flows(ccgt)</code>: The capacity is 200 MW, so the asset must produce an output flow lower than this value when the unit is online. The situation is similar as in the minimum operating point constraint, we have constraints for all the intersections of the resolutions to ensure the correct definition of the maximum capacity.</p><p class="math-container">\[\begin{aligned}
&amp; b_{k = 1:2}: v^{\text{flow}}_{(\text{ccgt,demand}),1:2} \leq 200 \cdot v^{\text{units on}}_{\text{ccgt},1:3} \\
&amp; b_{k = 3:3}: v^{\text{flow}}_{(\text{ccgt,demand}),3:4} \leq 200 \cdot v^{\text{units on}}_{\text{ccgt},1:3} \\
&amp; b_{k = 4:4}: v^{\text{flow}}_{(\text{ccgt,demand}),3:4} \leq 200 \cdot v^{\text{units on}}_{\text{ccgt},4:6} \\
&amp; b_{k = 5:6}: v^{\text{flow}}_{(\text{ccgt,demand}),5:6} \leq 200 \cdot v^{\text{units on}}_{\text{ccgt},4:6} \\
&amp; ...
\end{aligned}\]</p><p><code>max_ramp_up(ccgt)</code>: The ramping capacity is 120MW, so the change in the output flow above the minimum operating point needs to be below that value when the asset is online. When the time resolutions of the flow and <code>units_on</code> are not multiples of each other, we encounter some counterintuitive constraints. For example, consider the constraint at timestep block <code>4:4</code>. This constraint only involves <code>units_on</code> variables because the flow above the minimum operating point at timestep block <code>4:4</code> differs from the previous timestep block <code>3:3</code> only in terms of the <code>units_on</code> variables. As a result, the ramping-up constraint establishes a relationship between the <code>units_on</code> variable at <code>1:3</code> and <code>4:6</code>. This means that if the unit is on at timestep <code>1:3</code>, then it must also be on at timestep <code>4:6</code>. However, this is redundant because there is already a flow variable defined for <code>3:4</code> that ensures this, thanks to the minimum operating point and maximum capacity constraints. Therefore, although this constraint is not incorrect, it is unnecessary due to the flexible time resolutions that are not multiples of each other.</p><p class="math-container">\[\begin{aligned}
&amp; b_{k = 3:3}: - v^{\text{flow}}_{(\text{ccgt,demand}),1:2} + v^{\text{flow}}_{(\text{ccgt,demand}),3:4} \leq 120 \cdot v^{\text{units on}}_{\text{ccgt},1:3} \\
&amp; b_{k = 4:4}: 0 \leq - 50 \cdot v^{\text{units on}}_{\text{ccgt},1:3} + 170 \cdot v^{\text{units on}}_{\text{ccgt},4:6} \\
&amp; b_{k = 5:6}: - v^{\text{flow}}_{(\text{ccgt,demand}),3:4} + v^{\text{flow}}_{(\text{ccgt,demand}),5:6} \leq 120 \cdot v^{\text{units on}}_{\text{ccgt},4:6} \\
&amp; b_{k = 7:8}: - v^{\text{flow}}_{(\text{ccgt,demand}),5:6} + v^{\text{flow}}_{(\text{ccgt,demand}),7:8} \leq - 50 \cdot v^{\text{units on}}_{\text{ccgt},4:6} + 170 \cdot v^{\text{units on}}_{\text{ccgt},7:9} \\
&amp; b_{k = 9:9}: - v^{\text{flow}}_{(\text{ccgt,demand}),7:8} + v^{\text{flow}}_{(\text{ccgt,demand}),9:10} \leq 120 \cdot v^{\text{units on}}_{\text{ccgt},7:9} \\
&amp; ...
\end{aligned}\]</p><p>For the maximum ramp down we have similiar constraints as the ones shown above.</p><div class="admonition is-warning" id="Avoiding-redundant-constraints-4bc8263deedf37b1"><header class="admonition-header">Avoiding redundant constraints<a class="admonition-anchor" href="#Avoiding-redundant-constraints-4bc8263deedf37b1" title="Permalink"></a></header><div class="admonition-body"><p>The time resolutions of the unit commitment constraints do not have to be multiples of each other. However, using multiples of each other can help avoid extra redundant constraints.</p></div></div><h3 id="Unit-Commitment-and-Ramping-Case-Study-Results"><a class="docs-heading-anchor" href="#Unit-Commitment-and-Ramping-Case-Study-Results">Unit Commitment and Ramping Case Study Results</a><a id="Unit-Commitment-and-Ramping-Case-Study-Results-1"></a><a class="docs-heading-anchor-permalink" href="#Unit-Commitment-and-Ramping-Case-Study-Results" title="Permalink"></a></h3><p>Let&#39;s now optimize the model for the data in the example <a href="https://github.com/TulipaEnergy/TulipaEnergyModel.jl/tree/main/test/inputs/UC-ramping"><code>test/inputs/UC-ramping</code></a> and explore the results. The first result is the unit commitment of the assets with this method, i.e., <code>ocgt</code>, <code>ccgt</code>, and <code>smr</code>. One of the characteristics of having flexible time resolution on the unit commitment variables (e.g., <code>units_on</code>) is that it allows us to consider implicitly minimum up/down times in a simplified manner. For instance, the <code>ccgt</code> asset can only increase the number of units every 3h, and the <code>smr</code> can only start up again after 6h.</p><p><img src="../figs/unit-commitment-results.png" alt="unit-commitment-results"/></p><p>Let&#39;s now examine the hourly production balance in the results. We can see that the assets with a unit commitment method only produce electricity (e.g., flow to the demand asset) when they are on (<code>units_on &gt;= 1</code>). In addition, the <code>smr</code> has a slow flow change due to its ramping limits.</p><p><img src="../figs/unit-commitment-balance.png" alt="unit-commitment-balance"/></p><p>In this example, we demonstrated the use of unit commitment and ramping constraints with flexible time resolution in the model, and we illustrated what the results look like. The flexible time resolution applied to the unit commitment variables aids in minimizing the number of binary/integer variables in the model and simplifies the representation of the assets&#39; minimum up and down times.</p><h2 id="storage-modeling"><a class="docs-heading-anchor" href="#storage-modeling">Storage Modeling</a><a id="storage-modeling-1"></a><a class="docs-heading-anchor-permalink" href="#storage-modeling" title="Permalink"></a></h2><p>Energy storage systems can be broadly classified into two categories: seasonal and non-seasonal storage. Seasonal storage refers to assets that can store energy for more extended periods, usually spanning months or even years. Examples of such assets include hydro reservoirs, hydrogen storage in salt caverns, or empty gas fields. On the other hand, non-seasonal storage refers to assets that can store energy only for a few hours, such as batteries or small pumped-hydro storage units.</p><p>Both storage categories can be represented in <em>TulipaEnergyModel.jl</em> using the representative periods approach:</p><ul><li><em>Non-seasonal storage</em>: When the storage capacity of an asset is lower than the total length of representative periods, like in the case of a battery with a storage capacity of 4 hours and representative periods of 24-hour timesteps, rep-period constraints should be applied.</li><li><em>Seasonal storage</em>: When the storage capacity of an asset is greater than the total length of representative periods, like in the case of a hydroplant with a storage capacity of a month and representative periods of 24-hour timesteps, over-clustered-year constraints should be applied.</li></ul><p>The equations of rep-period and over-clustered-year constraints for energy storage are available in the <a href="../40-scientific-foundation/40-formulation/#formulation"><code>mathematical formulation</code></a>. An example is shown in the following section to explain these concepts. In addition, the section <a href="../20-user-guide/20-how-to-use/#seasonal-setup"><code>seasonal and non-seasonal storage setup</code></a> shows how to set the parameters in the model to consider each type in the storage assets.</p><h3 id="Example-to-Model-Seasonal-and-Non-seasonal-Storage"><a class="docs-heading-anchor" href="#Example-to-Model-Seasonal-and-Non-seasonal-Storage">Example to Model Seasonal and Non-seasonal Storage</a><a id="Example-to-Model-Seasonal-and-Non-seasonal-Storage-1"></a><a class="docs-heading-anchor-permalink" href="#Example-to-Model-Seasonal-and-Non-seasonal-Storage" title="Permalink"></a></h3><p>We use the example in the folder <a href="https://github.com/TulipaEnergy/TulipaEnergyModel.jl/tree/main/test/inputs/Storage"><code>test/inputs/Storage</code></a> to explain how all these concepts come together in <em>TulipaEnergyModel.jl</em>.</p><p>Let&#39;s first look at this feature&#39;s most relevant input data in the input files. Here, we show only the storage assets and the appropriate columns for this example, but all the input data can be found in the previously mentioned folder.</p><div><div style = "float: left;"><span>2×5 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">asset</th><th style = "text-align: left;">type</th><th style = "text-align: left;">capacity</th><th style = "text-align: left;">capacity_storage_energy</th><th style = "text-align: left;">is_seasonal</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "InlineStrings.String7" style = "text-align: left;">String7</th><th title = "InlineStrings.String15" style = "text-align: left;">String15</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Bool" style = "text-align: left;">Bool</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">battery</td><td style = "text-align: left;">storage</td><td style = "text-align: right;">10.0</td><td style = "text-align: right;">20.0</td><td style = "text-align: right;">false</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">phs</td><td style = "text-align: left;">storage</td><td style = "text-align: right;">100.0</td><td style = "text-align: right;">4800.0</td><td style = "text-align: right;">true</td></tr></tbody></table></div><p>The <code>is_seasonal</code> parameter determines whether or not the storage asset uses the over-clustered-year constraints. The <code>phs</code> is the only storage asset with this type of constraint and over-clustered-year-storage level variable (i.e., <span>$v^{\text{over-clustered-year-storage}}_{\text{phs},p}$</span>), and has 100MW capacity and 4800MWh of storage capacity (i.e., 48h discharge duration). The <code>battery</code> will only consider rep-period constraints with rep-period-storage level variables (i.e., <span>$v^{\text{rep-period-storage}}_{\text{battery},k,b_k}$</span>), and has 10MW capacity with 20MWh of storage capacity (i.e., 2h discharge duration).</p><p>The <code>rep-periods-data</code> file has information on the representative periods in the example. We have three representative periods, each with 24 timesteps and hourly resolution, representing a day. The figure below shows the availability profile of the renewable energy sources in the example.</p><div><div style = "float: left;"><span>3×4 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">year</th><th style = "text-align: left;">rep_period</th><th style = "text-align: left;">num_timesteps</th><th style = "text-align: left;">resolution</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: right;">2030</td><td style = "text-align: right;">1</td><td style = "text-align: right;">24</td><td style = "text-align: right;">1.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: right;">2030</td><td style = "text-align: right;">2</td><td style = "text-align: right;">24</td><td style = "text-align: right;">1.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: right;">2030</td><td style = "text-align: right;">3</td><td style = "text-align: right;">24</td><td style = "text-align: right;">1.0</td></tr></tbody></table></div><p><img src="../figs/availability-profiles.png" alt="availability-profiles"/></p><p>The <code>rep-periods-mapping</code> relates each representative period with the periods in the timeframe. We have seven periods in this case, meaning the timeframe is a week. Each value in the file indicates the weight of each representative period in the timeframe period. Notice that each period is composed of a linear combination of the representative periods. For more details on obtaining the representative periods and the weights, please look at <a href="https://github.com/TulipaEnergy/TulipaClustering.jl"><em>TulipaClustering.jl</em></a>. For the sake of readability, we show here the information in the file in tabular form:</p><div><div style = "float: left;"><span>7×4 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">period</th><th style = "text-align: left;">k=1</th><th style = "text-align: left;">k=2</th><th style = "text-align: left;">k=3</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0.0</td><td style = "text-align: right;">1.0</td><td style = "text-align: right;">0.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: right;">2</td><td style = "text-align: right;">0.2</td><td style = "text-align: right;">0.7</td><td style = "text-align: right;">0.1</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: right;">3</td><td style = "text-align: right;">0.0</td><td style = "text-align: right;">0.8</td><td style = "text-align: right;">0.2</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: right;">4</td><td style = "text-align: right;">0.3</td><td style = "text-align: right;">0.6</td><td style = "text-align: right;">0.1</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: right;">5</td><td style = "text-align: right;">0.1</td><td style = "text-align: right;">0.6</td><td style = "text-align: right;">0.3</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">6</td><td style = "text-align: right;">6</td><td style = "text-align: right;">0.1</td><td style = "text-align: right;">0.3</td><td style = "text-align: right;">0.6</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">7</td><td style = "text-align: right;">7</td><td style = "text-align: right;">0.8</td><td style = "text-align: right;">0.2</td><td style = "text-align: right;">0.0</td></tr></tbody></table></div><p>The file <code>assets-timeframe-partitions</code> has the information on how often we want to evaluate the over-clustered-year constraints that combine the information of the representative periods. In this example, the file is missing in the folder, meaning that the default of a <code>uniform</code> distribution of one period will be use in the model, see <a href="../20-user-guide/50-schemas/#table-schemas">model parameters</a> section. This assumption implies that the model will check the over-clustered-year-storage level every day of the week timeframe.</p><div class="admonition is-info" id="Info-af7c0f61f013d62d"><header class="admonition-header">Info<a class="admonition-anchor" href="#Info-af7c0f61f013d62d" title="Permalink"></a></header><div class="admonition-body"><p>For the sake of simplicity, we show how using three representative days can recover part of the chronological information of one week. The same method can be applied to more representative periods to analyze the seasonality across a year or longer timeframe.</p></div></div><p>Now let&#39;s solve the example and explore the results:</p><pre><code class="language-julia hljs">using DuckDB, TulipaIO, TulipaEnergyModel

# input_dir should be the path to the Storage example
connection = DBInterface.connect(DuckDB.DB)
read_csv_folder(connection, input_dir; schemas = TulipaEnergyModel.schema_per_table_name)
energy_problem = run_scenario(connection)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">EnergyProblem:
  - Model created!
    - Number of variables: 727
    - Number of constraints for variable bounds: 727
    - Number of structural constraints: 957
  - Model solved!
    - Termination status: OPTIMAL
    - Objective value: 2542.2343777832148
</code></pre><p>Since the <code>battery</code> is not seasonal, it only has results for the rep-period-storage level of each representative period, as shown in the following figure:</p><p><img src="../figs/intra-storage-level.png" alt="Battery-rep-period-storage-level"/></p><p>Since the <code>phs</code> is defined as seasonal, it has results for only the over-clustered-year-storage level. Since we defined the period partition as 1, we get results for each period (i.e., day). We can see that the over-clustered-year constraints in the model keep track of the storage level through the whole timeframe definition (i.e., week).</p><p><img src="../figs/inter-storage-level.png" alt="PHS-over-clustered-year-storage-level"/></p><p>In this example, we have demonstrated how to partially recover the chronological information of a storage asset with a longer discharge duration (such as 48 hours) than the representative period length (24 hours). This feature enables us to model both short- and long-term storage in <em>TulipaEnergyModel.jl</em>.</p><h2 id="flex-time-res-dc-opf"><a class="docs-heading-anchor" href="#flex-time-res-dc-opf">Flexible Time Resolution in the Direct Current Optimal Power Flow Constraints</a><a id="flex-time-res-dc-opf-1"></a><a class="docs-heading-anchor-permalink" href="#flex-time-res-dc-opf" title="Permalink"></a></h2><p>In this section, we show how flexible time resolution is applied when considering the model&#39;s direct current optimal power flow (DC-OPF) constraint. Let&#39;s consider the example in the folder <a href="https://github.com/TulipaEnergy/TulipaEnergyModel.jl/tree/main/test/inputs/Power-flow"><code>test/inputs/Power-flow</code></a> to explain how this constraint is created in <em>TulipaEnergyModel.jl</em> when having the flexible time resolution.</p><p>The following example demonstrates the impact of the DC-OPF constraints on system behavior. In this setup, demand can be met by two sources: <code>ccgt</code>and <code>hub</code>. The <code>hub</code> itself can receive energy from both <code>ccgt</code> and <code>electricity imports</code>. In the absence of power flow constraints, the model may choose to satisfy 100% of the demand directly via the <code>ccgt</code> to <code>demand</code> flow. However, when DC-OPF constraints are enforced, all three transport flows — <code>ccgt</code> to <code>demand</code>, <code>ccgt</code> to <code>hub</code>, and <code>hub</code> to <code>demand</code> must comply with the physical laws governing power flow. As a result, it becomes infeasible to supply the entire demand solely through the <code>ccgt</code> to <code>demand</code> path. Instead, the solution must account for the distribution of flows in accordance with the DC-OPF model.</p><p><img src="../figs/power_flow_example.png" alt="power-flow-example"/></p><p>The <code>assets-rep-periods-partitions</code> file defines the time resolution for the assets in the <code>partition</code> column. Here we set the time resolution to 8h for the <code>ccgt</code>, 4h for the <code>demand</code>, 2h for the <code>hub</code>, and 1h for the <code>import</code>.</p><div><div style = "float: left;"><span>4×3 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">asset</th><th style = "text-align: left;">specification</th><th style = "text-align: left;">partition</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "InlineStrings.String7" style = "text-align: left;">String7</th><th title = "InlineStrings.String7" style = "text-align: left;">String7</th><th title = "Int64" style = "text-align: left;">Int64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">ccgt</td><td style = "text-align: left;">uniform</td><td style = "text-align: right;">8</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">demand</td><td style = "text-align: left;">uniform</td><td style = "text-align: right;">4</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: left;">hub</td><td style = "text-align: left;">uniform</td><td style = "text-align: right;">2</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: left;">import</td><td style = "text-align: left;">uniform</td><td style = "text-align: right;">1</td></tr></tbody></table></div><div class="admonition is-info" id="Do-you-still-remember-what-resolution-of-the-assets-is-used-for?-36c8c47025c49669"><header class="admonition-header">Do you still remember what resolution of the assets is used for?<a class="admonition-anchor" href="#Do-you-still-remember-what-resolution-of-the-assets-is-used-for?-36c8c47025c49669" title="Permalink"></a></header><div class="admonition-body"><ol><li>The resolutions of the assets determine the resolution of the unit commitment variables (when UC constraints are applied), storage level variables, and electricity angle variables (when DC-OPF constraints are applied).</li><li>It is important to note that these resolutions do not dictate the resolution of the balance constraints. Instead, the resolution of balance constraints is derived from the rules outlined in the table under the section <a href="#flex-time-res"><code>flexible time resolution</code></a>.</li></ol></div></div><p>The <code>flows-rep-periods-partitions</code> file defines the time resolution for the flows, as shown below.</p><div><div style = "float: left;"><span>4×4 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">from_asset</th><th style = "text-align: left;">to_asset</th><th style = "text-align: left;">specification</th><th style = "text-align: left;">partition</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "InlineStrings.String7" style = "text-align: left;">String7</th><th title = "InlineStrings.String7" style = "text-align: left;">String7</th><th title = "InlineStrings.String7" style = "text-align: left;">String7</th><th title = "Int64" style = "text-align: left;">Int64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">ccgt</td><td style = "text-align: left;">hub</td><td style = "text-align: left;">uniform</td><td style = "text-align: right;">2</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">ccgt</td><td style = "text-align: left;">demand</td><td style = "text-align: left;">uniform</td><td style = "text-align: right;">4</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: left;">hub</td><td style = "text-align: left;">demand</td><td style = "text-align: left;">uniform</td><td style = "text-align: right;">2</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: left;">import</td><td style = "text-align: left;">hub</td><td style = "text-align: left;">uniform</td><td style = "text-align: right;">2</td></tr></tbody></table></div><h3 id="The-Core-Model"><a class="docs-heading-anchor" href="#The-Core-Model">The Core Model</a><a id="The-Core-Model-1"></a><a class="docs-heading-anchor-permalink" href="#The-Core-Model" title="Permalink"></a></h3><h4 id="DC-OPF-Constraints"><a class="docs-heading-anchor" href="#DC-OPF-Constraints">DC-OPF Constraints</a><a id="DC-OPF-Constraints-1"></a><a class="docs-heading-anchor-permalink" href="#DC-OPF-Constraints" title="Permalink"></a></h4><p>The DC-OPF constraint is applied to every transport flow that utilizes the DC-OPF method. The resolution at which this constraint is enforced is determined by the highest resolution among the flow itself and its adjacent (neighboring) assets. To illustrate how this works in practice, we now examine each relevant flow individually.</p><p>The resolution of the DC-OPF constraint for flow <code>ccgt</code> to <code>hub</code> is 2h:</p><p class="math-container">\[\begin{aligned}
&amp; \text{DC-OPF}_{(\text{ccgt}, \text{hub}),1:2}: \\
&amp; \qquad v^{\text{flow}}_{(\text{ccgt},\text{hub}),1:2} = \frac{p^{\text{power system base}}}{p^{\text{reactance}}_{\text{ccgt},\text{hub}}} (v^{\text{electricity angle}}_{\text{ccgt},1:8} - v^{\text{electricity angle}}_{\text{hub},1:2}) \\
\end{aligned}\]</p><p>The resolution of the DC-OPF constraint for flow <code>ccgt</code> to <code>demand</code> is 4h:</p><p class="math-container">\[\begin{aligned}
&amp; \text{DC-OPF}_{(\text{ccgt}, \text{demand}),1:4}: \\
&amp; \qquad v^{\text{flow}}_{(\text{ccgt},\text{demand}),1:4} = \frac{p^{\text{power system base}}}{p^{\text{reactance}}_{\text{ccgt},\text{demand}}} (v^{\text{electricity angle}}_{\text{ccgt},1:8} - v^{\text{electricity angle}}_{\text{demand},1:4}) \\
\end{aligned}\]</p><p>The resolution of the DC-OPF constraint for flow <code>hub</code> to <code>demand</code> is 2h:</p><p class="math-container">\[\begin{aligned}
&amp; \text{DC-OPF}_{(\text{hub}, \text{demand}),1:2}: \\
&amp; \qquad v^{\text{flow}}_{(\text{hub},\text{demand}),1:2} = \frac{p^{\text{power system base}}}{p^{\text{reactance}}_{\text{hub},\text{demand}}} (v^{\text{electricity angle}}_{\text{hub},1:2} - v^{\text{electricity angle}}_{\text{demand},1:4}) \\
\end{aligned}\]</p><h4 id="Consumer-Balance-Constraints"><a class="docs-heading-anchor" href="#Consumer-Balance-Constraints">Consumer Balance Constraints</a><a id="Consumer-Balance-Constraints-1"></a><a class="docs-heading-anchor-permalink" href="#Consumer-Balance-Constraints" title="Permalink"></a></h4><p>For <code>demand</code>, consumer balance applies. This constraint operates at the highest resolution among all incoming and outgoing flows connected to the asset. In this case, <code>demand</code> receives two incoming flows: <code>ccgt</code> to <code>demand</code> in 4h and <code>hub</code> to <code>demand</code> in 2h. As a result, the consumer balance is enforced in 2h resolution, which is the highest of the two.</p><p class="math-container">\[\begin{aligned}
&amp; \text{consumer\_balance}_{\text{demand},1:2}: \\
&amp; \qquad v^{\text{flow}}_{(\text{ccgt},\text{demand}),1:4} + v^{\text{flow}}_{(\text{hub},\text{demand}),1:2} \leq p^{\text{peak demand}}_{\text{demand}} \cdot \frac{\sum_{b=1}^{2} p^{\text{demand profile}}_{\text{demand},b}}{2} \\\\
\end{aligned}\]</p><h4 id="Hub-Balance-Constraints"><a class="docs-heading-anchor" href="#Hub-Balance-Constraints">Hub Balance Constraints</a><a id="Hub-Balance-Constraints-1"></a><a class="docs-heading-anchor-permalink" href="#Hub-Balance-Constraints" title="Permalink"></a></h4><p>For <code>hub</code>, hub balance applies. This constraint also operates at the highest resolution among all incoming and outgoing flows connected to the asset. In this case, <code>hub</code> receives two incoming flows: <code>ccgt</code> to <code>hub</code> in 2h and <code>import</code> to <code>hub</code> in 2h, and an outgoing flow <code>hub</code> to <code>demand</code> in 2h. As a result, the hub balance is enforced in 2h resolution, which is the highest of the three.</p><p class="math-container">\[\begin{aligned}
&amp; \text{hub\_balance}_{\text{demand},1:2}: \\
&amp; \qquad v^{\text{flow}}_{(\text{ccgt},\text{hub}),1:2} + v^{\text{flow}}_{(\text{import},\text{hub}),1:2} = v^{\text{flow}}_{(\text{hub},\text{demand}),1:2}  \\
\end{aligned}\]</p><p>The abovementioned constraints are functioning as intended, resulting in a feasible optimization problem.</p><h3 id="Model-Feasibility-Issues"><a class="docs-heading-anchor" href="#Model-Feasibility-Issues">Model Feasibility Issues</a><a id="Model-Feasibility-Issues-1"></a><a class="docs-heading-anchor-permalink" href="#Model-Feasibility-Issues" title="Permalink"></a></h3><p>Model feasibility can be compromised in two key ways:</p><ul><li><p>Incorrect flow resolutions — If the temporal resolutions of flows are not aligned with those of their neighboring assets, or if they violate resolution consistency rules, the model may become infeasible or produce redundant variables.</p></li><li><p>Poorly defined problem topology — If the graph structure (i.e., the set of assets and their connecting flows) is not well-constructed — such as having insufficient connectivity at key assets like hubs — the model may lack the necessary degrees of freedom to satisfy constraints, particularly under DC-OPF formulations.</p></li></ul><p>Let&#39;s first elaborate on the first case.</p><h4 id="Incorrect-Flow-Resolutions:-Why-Enforce-the-Flow-Resolution-This-Way?"><a class="docs-heading-anchor" href="#Incorrect-Flow-Resolutions:-Why-Enforce-the-Flow-Resolution-This-Way?">Incorrect Flow Resolutions: Why Enforce the Flow Resolution This Way?</a><a id="Incorrect-Flow-Resolutions:-Why-Enforce-the-Flow-Resolution-This-Way?-1"></a><a class="docs-heading-anchor-permalink" href="#Incorrect-Flow-Resolutions:-Why-Enforce-the-Flow-Resolution-This-Way?" title="Permalink"></a></h4><p>This raises a valid question. To explore this further, let’s consider a scenario with an even higher resolution. Suppose we now set the resolution of the flow from <code>ccgt</code> to <code>hub</code> to 1h. According to the modeling rules, this means the DC-OPF constraint must also be enforced at 1h resolution, as it must match the highest resolution among the flow and its neighboring assets.</p><p class="math-container">\[\begin{aligned}
&amp; \text{DC-OPF}_{(\text{ccgt}, \text{hub}),1:1}: \\
&amp; \qquad v^{\text{flow}}_{(\text{ccgt},\text{hub}),1:1} = \frac{p^{\text{power system base}}}{p^{\text{reactance}}_{\text{ccgt},\text{hub}}} (v^{\text{electricity angle}}_{\text{ccgt},1:8} - v^{\text{electricity angle}}_{\text{hub},1:2}) \\
&amp; \text{DC-OPF}_{(\text{ccgt}, \text{hub}),2:2}: \\
&amp; \qquad v^{\text{flow}}_{(\text{ccgt},\text{hub}),2:2} = \frac{p^{\text{power system base}}}{p^{\text{reactance}}_{\text{ccgt},\text{hub}}} (v^{\text{electricity angle}}_{\text{ccgt},1:8} - v^{\text{electricity angle}}_{\text{hub},1:2}) \\
\end{aligned}\]</p><p>Interestingly, in this setup, the right-hand sides (RHS) of the DC-OPF equations remain the same across time steps. This leads to the creation of two separate flow variables <span>$v^{\text{flow}}_{(\text{ccgt},\text{hub}),1:1}$</span> and <span>$v^{\text{flow}}_{(\text{ccgt},\text{hub}),2:2}$</span>.</p><p>However, since the RHS values are identical, one of these variables becomes redundant. This redundancy highlights a key modeling insight: not every combination of resolutions is viable or meaningful. Introducing unnecessarily high resolution without corresponding variation in the system can lead to inefficient formulations.</p><div class="admonition is-warning" id="The-flow-resolution-must-be-defined-as-the-highest-between-the-resolutions-of-its-adjacent-(neighboring)-assets!-9f394e6c479166fa"><header class="admonition-header">The flow resolution must be defined as the highest between the resolutions of its adjacent (neighboring) assets!<a class="admonition-anchor" href="#The-flow-resolution-must-be-defined-as-the-highest-between-the-resolutions-of-its-adjacent-(neighboring)-assets!-9f394e6c479166fa" title="Permalink"></a></header><div class="admonition-body"><ol><li>Higher resolution can improve temporal accuracy but may lead to formulation inefficiencies, such as redundant variables or unnecessarily large problem sizes, as illustrated in the previous example.</li><li>Lower resolution, on the other hand, may result in an infeasible model if it fails to capture the necessary dynamics or violates resolution consistency rules (e.g., with neighboring assets or constraints).</li></ol></div></div><h4 id="Poorly-Defined-Problem-Topology:-Why-Include-Import?"><a class="docs-heading-anchor" href="#Poorly-Defined-Problem-Topology:-Why-Include-Import?">Poorly Defined Problem Topology: Why Include Import?</a><a id="Poorly-Defined-Problem-Topology:-Why-Include-Import?-1"></a><a class="docs-heading-anchor-permalink" href="#Poorly-Defined-Problem-Topology:-Why-Include-Import?" title="Permalink"></a></h4><p>It is considered good modeling practice to connect the hub asset to more than two flows.</p><ul><li>Without DC-OPF constraints, having only two flows connected to the hub is not ideal but still valid. In such cases, the hub simply acts as a passive energy transfer point.</li><li>With DC-OPF constraints, however, having only two flows connected to the hub (e.g., <code>ccgt</code> to <code>hub</code> and <code>hub</code> to <code>demand</code>, without import) becomes incorrect. Let&#39;s show the issue below.</li></ul><p>Firstly of all, we list the hub balance and the two DC-OPF constraints for <code>1:2</code> and <code>3:4</code> as follows.</p><p class="math-container">\[\begin{aligned}
&amp; \text{hub\_balance}_{\text{demand},1:2}: \\
&amp; \qquad v^{\text{flow}}_{(\text{ccgt},\text{hub}),1:2} = v^{\text{flow}}_{(\text{hub},\text{demand}),1:2}  \\
&amp; \text{hub\_balance}_{\text{demand},3:4}: \\
&amp; \qquad v^{\text{flow}}_{(\text{ccgt},\text{hub}),3:4} = v^{\text{flow}}_{(\text{hub},\text{demand}),3:4}  \\
&amp; \text{DC-OPF}_{(\text{ccgt}, \text{hub}),1:2}: \\
&amp; \qquad v^{\text{flow}}_{(\text{ccgt},\text{hub}),1:2} = \frac{p^{\text{power system base}}}{p^{\text{reactance}}_{\text{ccgt},\text{hub}}} (v^{\text{electricity angle}}_{\text{ccgt},1:8} - v^{\text{electricity angle}}_{\text{hub},1:2}) \\
&amp; \text{DC-OPF}_{(\text{ccgt}, \text{hub}),3:4}: \\
&amp; \qquad v^{\text{flow}}_{(\text{ccgt},\text{hub}),3:4} = \frac{p^{\text{power system base}}}{p^{\text{reactance}}_{\text{ccgt},\text{hub}}} (v^{\text{electricity angle}}_{\text{ccgt},1:8} - v^{\text{electricity angle}}_{\text{hub},3:4}) \\
&amp; \text{DC-OPF}_{(\text{hub}, \text{demand}),1:2}: \\
&amp; \qquad v^{\text{flow}}_{(\text{hub},\text{demand}),1:2} = \frac{p^{\text{power system base}}}{p^{\text{reactance}}_{\text{hub},\text{demand}}} (v^{\text{electricity angle}}_{\text{hub},1:2} - v^{\text{electricity angle}}_{\text{demand},1:4}) \\
&amp; \text{DC-OPF}_{(\text{hub}, \text{demand}),3:4}: \\
&amp; \qquad v^{\text{flow}}_{(\text{hub},\text{demand}),3:4} = \frac{p^{\text{power system base}}}{p^{\text{reactance}}_{\text{hub},\text{demand}}} (v^{\text{electricity angle}}_{\text{hub},3:4} - v^{\text{electricity angle}}_{\text{demand},1:4}) \\
\end{aligned}\]</p><p>Next, we substitute the DC-OPF constraints into the hub balance. After some algebraic rearrangements, we obtain the following simplified expression:</p><p class="math-container">\[\begin{aligned}
&amp; \qquad v^{\text{electricity angle}}_{\text{hub},1:2} = v^{\text{electricity angle}}_{\text{hub},3:4}
\end{aligned}\]</p><p>Guess what? We have identified one redundant variable. Now, by examining the following two DC-OPF constraints more closely, we may uncover additional issues:</p><p class="math-container">\[\begin{aligned}
&amp; \text{DC-OPF}_{(\text{hub}, \text{demand}),1:2}: \\
&amp; \qquad v^{\text{flow}}_{(\text{hub},\text{demand}),1:2} = \frac{p^{\text{power system base}}}{p^{\text{reactance}}_{\text{hub},\text{demand}}} (v^{\text{electricity angle}}_{\text{hub},1:2} - v^{\text{electricity angle}}_{\text{demand},1:4}) \\
&amp; \text{DC-OPF}_{(\text{hub}, \text{demand}),3:4}: \\
&amp; \qquad v^{\text{flow}}_{(\text{hub},\text{demand}),3:4} = \frac{p^{\text{power system base}}}{p^{\text{reactance}}_{\text{hub},\text{demand}}} (v^{\text{electricity angle}}_{\text{hub},3:4} - v^{\text{electricity angle}}_{\text{demand},1:4}) \\
\end{aligned}\]</p><p>We now actually have:</p><p class="math-container">\[\begin{aligned}
&amp; \qquad v^{\text{flow}}_{(\text{hub},\text{demand}),1:2} = v^{\text{flow}}_{(\text{hub},\text{demand}),3:4}
\end{aligned}\]</p><p>Leading to somewhere? Let&#39;s list the consumer balance:</p><p class="math-container">\[\begin{aligned}
&amp; \text{consumer\_balance}_{\text{demand},1:2}: \\
&amp; \qquad v^{\text{flow}}_{(\text{ccgt},\text{demand}),1:4} + v^{\text{flow}}_{(\text{hub},\text{demand}),1:2} \leq p^{\text{peak demand}}_{\text{demand}} \cdot \frac{\sum_{b=1}^{2} p^{\text{demand profile}}_{\text{demand},b}}{2} \\
&amp; \text{consumer\_balance}_{\text{demand},3:4}: \\
&amp; \qquad v^{\text{flow}}_{(\text{ccgt},\text{demand}),1:4} + v^{\text{flow}}_{(\text{hub},\text{demand}),3:4} \leq p^{\text{peak demand}}_{\text{demand}} \cdot \frac{\sum_{b=3}^{4} p^{\text{demand profile}}_{\text{demand},b}}{2} \\
\end{aligned}\]</p><p>Although the LHS of the two DC-OPF constraints are identical, their RHS differ. This discrepancy implies that the same variables are being forced to satisfy two conflicting conditions simultaneously. As a result, the model becomes infeasible.</p><h2 id="flex-time-res-mimo"><a class="docs-heading-anchor" href="#flex-time-res-mimo">Flexible Time Resolution in Assets with Multiple Input and Multiple Output (MIMO) and Flows Relationships</a><a id="flex-time-res-mimo-1"></a><a class="docs-heading-anchor-permalink" href="#flex-time-res-mimo" title="Permalink"></a></h2><p>In this section, we show how flexible time resolution is applied when considering assets with Multiple Inputs and Multiple Outputs (MIMO) and flows relationship constraints. Let&#39;s consider the example in the folder <a href="https://github.com/TulipaEnergy/TulipaEnergyModel.jl/tree/main/test/inputs/MIMO"><code>test/inputs/MIMO</code></a> to explain how these constraints are created in <em>TulipaEnergyModel.jl</em> when having the flexible time resolution. Here is a representation of the energy system in the example.</p><p><img src="../figs/mimo-example.png" alt="mimo-example"/></p><p>The example has two sources of energy <code>biomass</code> and <code>gas_market</code>, three conversion assets <code>power_plant</code>, <code>chp_backpressure</code>, and <code>chp_extraction</code>, two demands of energy represented by <code>electricity_demand</code> and <code>heat_demand</code>, and finally a by-product CO2 emmisions that goes to the asset <code>atmosphere</code>. The table below shows the type of each asset. Notice that the <code>biomass</code> asset is modeled as a storage and the <code>atmosphere</code> as a consumer. We will return to these definitions later in this section, but bear with us and keep this in mind.</p><div><div style = "float: left;"><span>8×4 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">asset</th><th style = "text-align: left;">type</th><th style = "text-align: left;">capacity</th><th style = "text-align: left;">consumer_balance_sense</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "InlineStrings.String31" style = "text-align: left;">String31</th><th title = "InlineStrings.String15" style = "text-align: left;">String15</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "InlineStrings.String3" style = "text-align: left;">String3</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">power_plant</td><td style = "text-align: left;">conversion</td><td style = "text-align: right;">400</td><td style = "text-align: left;">==</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">chp_backpressure</td><td style = "text-align: left;">conversion</td><td style = "text-align: right;">35</td><td style = "text-align: left;">==</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: left;">chp_extraction</td><td style = "text-align: left;">conversion</td><td style = "text-align: right;">35</td><td style = "text-align: left;">==</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: left;">gas_market</td><td style = "text-align: left;">producer</td><td style = "text-align: right;">1000</td><td style = "text-align: left;">==</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: left;">biomass</td><td style = "text-align: left;">storage</td><td style = "text-align: right;">400</td><td style = "text-align: left;">==</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">6</td><td style = "text-align: left;">electricity_demand</td><td style = "text-align: left;">consumer</td><td style = "text-align: right;">0</td><td style = "text-align: left;">==</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">7</td><td style = "text-align: left;">heat_demand</td><td style = "text-align: left;">consumer</td><td style = "text-align: right;">0</td><td style = "text-align: left;">&gt;=</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">8</td><td style = "text-align: left;">atmosphere</td><td style = "text-align: left;">consumer</td><td style = "text-align: right;">0</td><td style = "text-align: left;">&gt;=</td></tr></tbody></table></div><p>Notice that the <code>heat_demand</code> and the <code>atmosphere</code> are modeled as consumer assets with a sense <span>$\geq$</span>, meaning that the sum</p><p>As for the flexible time resolution, the <code>flows-rep-periods-partitions</code> file defines them for the flows in the energy system, as shown below. Here, the flows that go to the <code>atmosphere</code> have a uniform 24h resolution (i.e., daily); this will reduce the number of variables we need to account for the CO2 emissions and consider only one variable per day. The flows going out of the <code>gas_market</code> are every two hours, and the ones from the <code>biomass</code> every three hours. Why? Because we want to showcase in this example the fully flexible resolution in the model, however, in a real-life case study, the resolution will often be related to the energy carrier&#39;s dynamics or another expert&#39;s criteria to reduce the number of constraints.</p><div><div style = "float: left;"><span>7×4 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">from_asset</th><th style = "text-align: left;">to_asset</th><th style = "text-align: left;">specification</th><th style = "text-align: left;">partition</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "InlineStrings.String31" style = "text-align: left;">String31</th><th title = "InlineStrings.String31" style = "text-align: left;">String31</th><th title = "InlineStrings.String7" style = "text-align: left;">String7</th><th title = "Int64" style = "text-align: left;">Int64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">power_plant</td><td style = "text-align: left;">atmosphere</td><td style = "text-align: left;">uniform</td><td style = "text-align: right;">24</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">chp_backpressure</td><td style = "text-align: left;">atmosphere</td><td style = "text-align: left;">uniform</td><td style = "text-align: right;">24</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: left;">chp_extraction</td><td style = "text-align: left;">atmosphere</td><td style = "text-align: left;">uniform</td><td style = "text-align: right;">24</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: left;">gas_market</td><td style = "text-align: left;">power_plant</td><td style = "text-align: left;">uniform</td><td style = "text-align: right;">2</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: left;">gas_market</td><td style = "text-align: left;">chp_backpressure</td><td style = "text-align: left;">uniform</td><td style = "text-align: right;">2</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">6</td><td style = "text-align: left;">gas_market</td><td style = "text-align: left;">chp_extraction</td><td style = "text-align: left;">uniform</td><td style = "text-align: right;">2</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">7</td><td style = "text-align: left;">biomass</td><td style = "text-align: left;">power_plant</td><td style = "text-align: left;">uniform</td><td style = "text-align: right;">3</td></tr></tbody></table></div><div class="admonition is-info" id="Do-you-still-remember-what-resolution-of-the-flows-is-used-for?-bcf5e9d9fcab863e"><header class="admonition-header">Do you still remember what resolution of the flows is used for?<a class="admonition-anchor" href="#Do-you-still-remember-what-resolution-of-the-flows-is-used-for?-bcf5e9d9fcab863e" title="Permalink"></a></header><div class="admonition-body"><p>The assets and flows resolution determine the resolution of the model constraints considering the rules outlined in the table under the section <a href="#flex-time-res"><code>flexible time resolution</code></a>.</p></div></div><h3 id="Constraints-for-Flows-Relationships"><a class="docs-heading-anchor" href="#Constraints-for-Flows-Relationships">Constraints for Flows Relationships</a><a id="Constraints-for-Flows-Relationships-1"></a><a class="docs-heading-anchor-permalink" href="#Constraints-for-Flows-Relationships" title="Permalink"></a></h3><p>Thanks to the <a href="#flex-asset-connection"><code>flexible asset connection</code></a> in the model, any asset can have multiple inputs and outputs, as illustrated in the figure at the beginning of this section. By default, the flows corresponding to these inputs and outputs are independent of each other within the model. However, there are situations where these flows are related to each other. For example, by-products like CO2 emissions depend on the fuel consumption. Another instance is the residual heat produced by power plants, such as small modular reactors, when generating electricity. Additionally, combined heat and power (CHP) technologies can yield residual heat during electricity production and may have a more complex operational feasible region when generating both electricity and heat.</p><p>To model these interactions, we use a linear combination of flow variables known as flow relationships. These are outlined in the constraints found in the <a href="../40-scientific-foundation/40-formulation/#flows-relationships-constraints"><code>formulation section</code></a>. The relationships are defined in the <code>flows_relationships</code> file located in the example folder. In this section, we present these relationships in accordance with the constraints established in the model.</p><div><div style = "float: left;"><span>10×5 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">flow_1</th><th style = "text-align: left;">sense</th><th style = "text-align: left;">constant</th><th style = "text-align: left;">ratio</th><th style = "text-align: left;">flow_2</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "String" style = "text-align: left;">String</th><th title = "InlineStrings.String3" style = "text-align: left;">String3</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "String" style = "text-align: left;">String</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">(power_plant, electricity_demand)</td><td style = "text-align: left;">==</td><td style = "text-align: right;">0.0</td><td style = "text-align: right;">4.0</td><td style = "text-align: left;">(power_plant, heat_demand)</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">(power_plant, atmosphere)</td><td style = "text-align: left;">==</td><td style = "text-align: right;">0.0</td><td style = "text-align: right;">0.1575</td><td style = "text-align: left;">(gas_market, power_plant)</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: left;">(power_plant, atmosphere)</td><td style = "text-align: left;">==</td><td style = "text-align: right;">0.0</td><td style = "text-align: right;">0.15</td><td style = "text-align: left;">(biomass, power_plant)</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: left;">(chp_backpressure, electricity_demand)</td><td style = "text-align: left;">==</td><td style = "text-align: right;">0.0</td><td style = "text-align: right;">2.0</td><td style = "text-align: left;">(chp_backpressure, heat_demand)</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: left;">(chp_backpressure, atmosphere)</td><td style = "text-align: left;">==</td><td style = "text-align: right;">0.0</td><td style = "text-align: right;">0.18</td><td style = "text-align: left;">(chp_backpressure, electricity_demand)</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">6</td><td style = "text-align: left;">(chp_extraction, electricity_demand)</td><td style = "text-align: left;">&gt;=</td><td style = "text-align: right;">0.0</td><td style = "text-align: right;">1.8</td><td style = "text-align: left;">(chp_extraction, heat_demand)</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">7</td><td style = "text-align: left;">(chp_extraction, electricity_demand)</td><td style = "text-align: left;">&lt;=</td><td style = "text-align: right;">35.0</td><td style = "text-align: right;">-0.15</td><td style = "text-align: left;">(chp_extraction, heat_demand)</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">8</td><td style = "text-align: left;">(chp_extraction, electricity_demand)</td><td style = "text-align: left;">&gt;=</td><td style = "text-align: right;">15.0</td><td style = "text-align: right;">-0.15</td><td style = "text-align: left;">(chp_extraction, heat_demand)</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">9</td><td style = "text-align: left;">(chp_extraction, heat_demand)</td><td style = "text-align: left;">&lt;=</td><td style = "text-align: right;">13.61</td><td style = "text-align: right;">0.0</td><td style = "text-align: left;">(chp_extraction, electricity_demand)</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">10</td><td style = "text-align: left;">(chp_extraction, atmosphere)</td><td style = "text-align: left;">==</td><td style = "text-align: right;">0.0</td><td style = "text-align: right;">0.108</td><td style = "text-align: left;">(chp_extraction, electricity_demand)</td></tr></tbody></table></div><p>The table illustrates that the <code>power_plant</code> asset has three flow relationships: one connecting electricity and heat outputs, and two relating to CO2 emissions released into the atmosphere, which vary depending on the fuel used for energy production. For the <code>chp_backpressure</code> asset, there are two relationships: one representing the fixed ratio between electricity and heat, and another concerning CO2 emissions. Lastly, the <code>chp_extraction</code> asset features a fixed ratio for CO2 emissions, along with a set of inequalities that define the feasible operating region for heat and electricity production. The following figure displays this feasible region:</p><p><img src="../figs/chp-extraction.png" alt="chp-extraction"/></p><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&quot;                                                                                        #hide\n# To reproduce the chp extraction plot in Julia, use the following script                  #hide\nusing Plots                                                                      &quot;<span class="sgr93"><span class="sgr1"> ⋯ 6242 bytes ⋯ </span></span>&quot;                                                                         #hide\n)                                                                                          #hide\nsavefig(\&quot;chp-extraction.png\&quot;)                                                              #hide\n&quot;</code></pre><p>That looks cool 🤓 but, wait a minute! What about the flexible temporal resolution?</p><p>It&#39;s straightforward: When it comes to the constraints created by the flow relationships, the resulting resolution follows the highest resolution of the flows involved in the relationship. In simpler terms, this means it is determined by <code>max(flow1 resolution, flow2 resolution)</code>. Consequently, the resulting constraints are considered as energy constraints. Where do I find this information? Remember, the table in the section titled <a href="#flex-time-res"><code>flexible time resolution</code></a> summarizes all the rules 😉 .Now, let’s examine each relationship (<span>$x \in \mathcal{X}$</span>) closely:</p><ul><li>Relationship <span>$x_1$</span> = <strong>flow<em>1(power</em>plant, electricity<em>demand) and flow</em>2(power<em>plant, heat</em>demand)</strong>: both flows have an hourly resolution (i.e., deafult value) since they don&#39;t have any definition in the <code>flows-rep-periods-partitions</code> file. Therefore, the flows relationship constraint is also hourly.</li></ul><p class="math-container">\[\begin{aligned}
&amp; \text{flows\_relationship}_{x_1, 1, 1:1}: \\
&amp; v^{\text{flow}}_{(\text{power\_plant},\text{electricity\_demand}),1,1:1} =  4.0 \cdot v^{\text{flow}}_{(\text{power\_plant},\text{heat\_demand}),1,1:1} \\
&amp; \text{flows\_relationship}_{x_1, 1, 2:2}: \\
&amp; v^{\text{flow}}_{(\text{power\_plant},\text{electricity\_demand}),1,2:2} =  4.0 \cdot v^{\text{flow}}_{(\text{power\_plant},\text{heat\_demand}),1,2:2} \\
&amp; ...
\end{aligned}\]</p><ul><li>Relationship <code>x_2</code> = <strong>flow<em>1(power</em>plant, atmosphere) and flow<em>2(gas</em>market, power_plant)</strong>: The first flow has an uniform resolution of 24h and the second flow has an uniform resolution of 2h in their definitions. Therefore, the flows relationship constraint is in the highest resolution of both, i.e., every 24h. In addition, the constraint accounts for the durations, so each flow variable is then multiply by the it.</li></ul><p class="math-container">\[\begin{aligned}
&amp; \text{flows\_relationship}_{x_2, 1, 1:24}: \\
&amp; 24 \cdot v^{\text{flow}}_{(\text{power\_plant},\text{atmosphere}),1,1:24} =  0.1575 \cdot \sum_{b=1}^{12} 2 \cdot v^{\text{flow}}_{(\text{gas\_market},\text{power\_plant}),1,(2b-1):(2b)}
\end{aligned}\]</p><ul><li>Relationship <span>$x_3$</span> = <strong>flow<em>1(power</em>plant, atmosphere) and flow<em>2(biomass, power</em>plant)</strong>: The first flow has an uniform resolution of 24h and the second flow has an uniform resolution of 3h in their definitions. Therefore, the flows relationship constraint is in the highest resolution of both, i.e., every 24h. In addition, the constraint accounts for the durations, so each flow variable is then multiply by the it.</li></ul><p class="math-container">\[\begin{aligned}
&amp; \text{flows\_relationship}_{x_3, 1, 1:24}: \\
&amp; 24 \cdot v^{\text{flow}}_{(\text{power\_plant},\text{atmosphere}),1,1:24} =  0.15 \cdot \sum_{b=1}^{8} 3 \cdot v^{\text{flow}}_{(\text{biomass},\text{power\_plant}),1,(3b-2):(3b)}
\end{aligned}\]</p><ul><li>Relationship <span>$x_4$</span> = <strong>flow<em>1(chp</em>backpressure, electricity<em>demand) and flow</em>2(chp<em>backpressure, heat</em>demand)</strong>: both flows have an hourly resolution (i.e., deafult value). Therefore, the flows relationship constraint is also hourly.</li></ul><p class="math-container">\[\begin{aligned}
&amp; \text{flows\_relationship}_{x_4, 1, 1:1}: \\
&amp; v^{\text{flow}}_{(\text{chp\_backpressure},\text{electricity\_demand}),1,1:1} =  2.0 \cdot v^{\text{flow}}_{(\text{chp\_backpressure},\text{heat\_demand}),1,1:1} \\
&amp; \text{flows\_relationship}_{x_4, 1, 2:2}: \\
&amp; v^{\text{flow}}_{(\text{chp\_backpressure},\text{electricity\_demand}),1,2:2} =  2.0 \cdot v^{\text{flow}}_{(\text{chp\_backpressure},\text{heat\_demand}),1,2:2} \\
&amp; ...
\end{aligned}\]</p><ul><li>Relationship <span>$x_5$</span> = <strong>flow<em>1(chp</em>backpressure, atmosphere) and flow<em>2(chp</em>backpressure, electricity_demand)</strong>: The first flow has an uniform resolution of 24h and the second flow has an uniform resolution of 1h in their definitions. Therefore, the flows relationship constraint is in the highest resolution of both, i.e., every 24h. In addition, the constraint accounts for the durations, so each flow variable is then multiply by the it.</li></ul><p class="math-container">\[\begin{aligned}
&amp; \text{flows\_relationship}_{x_5, 1, 1:24}: \\
&amp; 24 \cdot v^{\text{flow}}_{(\text{chp\_backpressure},\text{atmosphere}),1,1:24} =  0.18 \cdot \sum_{b=1}^{24} v^{\text{flow}}_{(\text{chp\_backpressure},\text{electricity\_demand}),1,b:b}
\end{aligned}\]</p><ul><li>Relationship <span>$x_6$</span> = <strong>flow<em>1(chp</em>extraction, electricity<em>demand) and flow</em>2(chp<em>extraction, heat</em>demand)</strong>: both flows have an hourly resolution (i.e., deafult value). Therefore, the flows relationship constraint is also hourly.</li></ul><p class="math-container">\[\begin{aligned}
&amp; \text{flows\_relationship}_{x_6, 1, 1:1}: \\
&amp; v^{\text{flow}}_{(\text{chp\_extraction},\text{electricity\_demand}),1,1:1} \geq  1.8 \cdot v^{\text{flow}}_{(\text{chp\_extraction},\text{heat\_demand}),1,1:1} \\
&amp; \text{flows\_relationship}_{x_6, 1, 2:2}: \\
&amp; v^{\text{flow}}_{(\text{chp\_extraction},\text{electricity\_demand}),1,2:2} \geq  1.8 \cdot v^{\text{flow}}_{(\text{chp\_extraction},\text{heat\_demand}),1,2:2} \\
&amp; ...
\end{aligned}\]</p><ul><li>Relationship <span>$x_7$</span> = <strong>flow<em>1(chp</em>extraction, electricity<em>demand) and flow</em>2(chp<em>extraction, heat</em>demand)</strong>: both flows have an hourly resolution (i.e., deafult value). Therefore, the flows relationship constraint is also hourly.</li></ul><p class="math-container">\[\begin{aligned}
&amp; \text{flows\_relationship}_{x_7, 1, 1:1}: \\
&amp; v^{\text{flow}}_{(\text{chp\_extraction},\text{electricity\_demand}),1,1:1} \leq  35 - 0.15 \cdot v^{\text{flow}}_{(\text{chp\_extraction},\text{heat\_demand}),1,1:1} \\
&amp; \text{flows\_relationship}_{x_7, 1, 2:2}: \\
&amp; v^{\text{flow}}_{(\text{chp\_extraction},\text{electricity\_demand}),1,2:2} \leq  35 - 0.15 \cdot v^{\text{flow}}_{(\text{chp\_extraction},\text{heat\_demand}),1,2:2} \\
&amp; ...
\end{aligned}\]</p><ul><li>Relationship <span>$x_8$</span> = <strong>flow<em>1(chp</em>extraction, electricity<em>demand) and flow</em>2(chp<em>extraction, heat</em>demand)</strong>: both flows have an hourly resolution (i.e., deafult value). Therefore, the flows relationship constraint is also hourly.</li></ul><p class="math-container">\[\begin{aligned}
&amp; \text{flows\_relationship}_{x_8, 1, 1:1}: \\
&amp; v^{\text{flow}}_{(\text{chp\_extraction},\text{electricity\_demand}),1,1:1} \geq  15 - 0.15 \cdot v^{\text{flow}}_{(\text{chp\_extraction},\text{heat\_demand}),1,1:1} \\
&amp; \text{flows\_relationship}_{x_8, 1, 2:2}: \\
&amp; v^{\text{flow}}_{(\text{chp\_extraction},\text{electricity\_demand}),1,2:2} \geq  15 - 0.15 \cdot v^{\text{flow}}_{(\text{chp\_extraction},\text{heat\_demand}),1,2:2} \\
&amp; ...
\end{aligned}\]</p><ul><li>Relationship <span>$x_9$</span> = <strong>flow<em>1(chp</em>extraction, heat<em>demand) and flow</em>2(chp<em>extraction, electricity</em>demand)</strong>: both flows have an hourly resolution (i.e., deafult value). Therefore, the flows relationship constraint is also hourly. This constraint reprsents a simple limit for the maximum heat flow.</li></ul><p class="math-container">\[\begin{aligned}
&amp; \text{flows\_relationship}_{x_9, 1, 1:1}: \\
&amp; v^{\text{flow}}_{(\text{chp\_extraction},\text{heat\_demand}),1,1:1} \leq  13.61 \\
&amp; \text{flows\_relationship}_{x_9, 1, 2:2}: \\
&amp; v^{\text{flow}}_{(\text{chp\_extraction},\text{heat\_demand}),1,2:2} \leq  13.61 \\
&amp; ...
\end{aligned}\]</p><ul><li>Relationship <span>$x_{10}$</span> = <strong>flow<em>1(chp</em>extraction, atmosphere) and flow<em>2(chp</em>extraction, electricity_demand)</strong>: The first flow has an uniform resolution of 24h and the second flow has an uniform resolution of 1h in their definitions. Therefore, the flows relationship constraint is in the highest resolution of both, i.e., every 24h. In addition, the constraint accounts for the durations, so each flow variable is then multiply by the it.</li></ul><p class="math-container">\[\begin{aligned}
&amp; \text{flows\_relationship}_{x_{10}, 1, 1:24}: \\
&amp; 24 \cdot v^{\text{flow}}_{(\text{chp\_extraction},\text{atmosphere}),1,1:24} =  0.108 \cdot \sum_{b=1}^{24} v^{\text{flow}}_{(\text{chp\_extraction},\text{electricity\_demand}),1,b:b}
\end{aligned}\]</p><h3 id="The-Conversion-Coefficient-and-the-Conversion-Balance-Constraints"><a class="docs-heading-anchor" href="#The-Conversion-Coefficient-and-the-Conversion-Balance-Constraints">The Conversion Coefficient and the Conversion Balance Constraints</a><a id="The-Conversion-Coefficient-and-the-Conversion-Balance-Constraints-1"></a><a class="docs-heading-anchor-permalink" href="#The-Conversion-Coefficient-and-the-Conversion-Balance-Constraints" title="Permalink"></a></h3><p>The <a href="../20-user-guide/20-how-to-use/#coefficient-for-conversion-constraints"><code>conversion coefficient</code></a> is a key parameter in the <a href="../40-scientific-foundation/40-formulation/#conversion-balance-constraints"><code>conversion balance constraints</code></a>, especially for assets with MIMO and flexible temporal resolution. Remember that only flows with conversion coefficient greater than zero are considered to determine the resolution of the conversion balance constraint. So, let&#39;s explore each conversion asset in the example.</p><ul><li><strong>power_plant</strong>: This asset has two inputs and three outputs. However, the outputs to <code>heat_demand</code> and the <code>atmosphere</code> have a conversion coefficient of zero, as shown in the table below. This indicates that the constraint&#39;s resolution will be determined by the flows coming from the <code>biomass</code> and <code>gas_market</code>, alongside the output flow to <code>electricity_demand</code>. Therefore, the resolution for the conversion balance of this asset is: <code>max(3h, 2h, 1h) = 3h</code>.</li></ul><div><div style = "float: left;"><span>5×3 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">from_asset</th><th style = "text-align: left;">to_asset</th><th style = "text-align: left;">conversion_coefficient</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "InlineStrings.String31" style = "text-align: left;">String31</th><th title = "InlineStrings.String31" style = "text-align: left;">String31</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">gas_market</td><td style = "text-align: left;">power_plant</td><td style = "text-align: right;">0.45</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">biomass</td><td style = "text-align: left;">power_plant</td><td style = "text-align: right;">0.3</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: left;">power_plant</td><td style = "text-align: left;">electricity_demand</td><td style = "text-align: right;">1.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: left;">power_plant</td><td style = "text-align: left;">heat_demand</td><td style = "text-align: right;">0.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: left;">power_plant</td><td style = "text-align: left;">atmosphere</td><td style = "text-align: right;">0.0</td></tr></tbody></table></div><ul><li><strong>chp_backpressure</strong>: This asset has one input and three outputs. However, the output to <code>atmosphere</code> has a conversion coefficient of zero, as shown in the table below. This indicates that the constraint&#39;s resolution will be determined by the flow coming from the <code>gas_market</code>, alongside the outputs flows to <code>electricity_demand</code> and <code>heat_demand</code>. Therefore, the resolution for the conversion balance of this asset is: <code>max(2h, 1h, 1h) = 2h</code>.</li></ul><div><div style = "float: left;"><span>4×3 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">from_asset</th><th style = "text-align: left;">to_asset</th><th style = "text-align: left;">conversion_coefficient</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "InlineStrings.String31" style = "text-align: left;">String31</th><th title = "InlineStrings.String31" style = "text-align: left;">String31</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">gas_market</td><td style = "text-align: left;">chp_backpressure</td><td style = "text-align: right;">1.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">chp_backpressure</td><td style = "text-align: left;">electricity_demand</td><td style = "text-align: right;">1.41</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: left;">chp_backpressure</td><td style = "text-align: left;">heat_demand</td><td style = "text-align: right;">0.49</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: left;">chp_backpressure</td><td style = "text-align: left;">atmosphere</td><td style = "text-align: right;">0.0</td></tr></tbody></table></div><ul><li><strong>chp_extraction</strong>: This asset has one input and three outputs. However, the output to <code>atmosphere</code> has a conversion coefficient of zero, as shown in the table below. This indicates that the constraint&#39;s resolution will be determined by the flow coming from the <code>gas_market</code>, alongside the outputs flows to <code>electricity_demand</code> and <code>heat_demand</code>. Therefore, the resolution for the conversion balance of this asset is: <code>max(2h, 1h, 1h) = 2h</code>.</li></ul><div><div style = "float: left;"><span>4×3 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">from_asset</th><th style = "text-align: left;">to_asset</th><th style = "text-align: left;">conversion_coefficient</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "InlineStrings.String31" style = "text-align: left;">String31</th><th title = "InlineStrings.String31" style = "text-align: left;">String31</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">gas_market</td><td style = "text-align: left;">chp_extraction</td><td style = "text-align: right;">1.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">chp_extraction</td><td style = "text-align: left;">electricity_demand</td><td style = "text-align: right;">1.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: left;">chp_extraction</td><td style = "text-align: left;">heat_demand</td><td style = "text-align: right;">1.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: left;">chp_extraction</td><td style = "text-align: left;">atmosphere</td><td style = "text-align: right;">0.0</td></tr></tbody></table></div><h3 id="The-Capacity-Coefficient-and-the-Maximum-Capacity-Constraints"><a class="docs-heading-anchor" href="#The-Capacity-Coefficient-and-the-Maximum-Capacity-Constraints">The Capacity Coefficient and the Maximum Capacity Constraints</a><a id="The-Capacity-Coefficient-and-the-Maximum-Capacity-Constraints-1"></a><a class="docs-heading-anchor-permalink" href="#The-Capacity-Coefficient-and-the-Maximum-Capacity-Constraints" title="Permalink"></a></h3><p>The <a href="../20-user-guide/20-how-to-use/#coefficient-for-capacity-constraints"><code>capacity_coefficient</code></a> determines which output flows of an asset will be included in the <a href="../40-scientific-foundation/40-formulation/#cap-constraints"><code>capacity constraints</code></a> for that asset. This parameter is particularly important when an asset has outputs that are by-products, such as CO2 emissions. For example, all outputs from conversion assets to the atmosphere have a coefficient of zero (as shown in the table below), indicating that they will not be considered in the capacity constraints.</p><div><div style = "float: left;"><span>3×3 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">from_asset</th><th style = "text-align: left;">to_asset</th><th style = "text-align: left;">capacity_coefficient</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "InlineStrings.String31" style = "text-align: left;">String31</th><th title = "InlineStrings.String31" style = "text-align: left;">String31</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">power_plant</td><td style = "text-align: left;">atmosphere</td><td style = "text-align: right;">0.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">chp_backpressure</td><td style = "text-align: left;">atmosphere</td><td style = "text-align: right;">0.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: left;">chp_extraction</td><td style = "text-align: left;">atmosphere</td><td style = "text-align: right;">0.0</td></tr></tbody></table></div><p>Remember that the capacity constraints resolution are defined in the lowest resolution of the output flows since it is a power constraint. Notice that all the conversion assets have three outputs <code>electricity_demand</code>, <code>heat_demand</code>, and <code>atmosphere</code>. Therefore, the resolution for the output capacity constraint of those assets is: <code>min(1h, 1h, 24h) = 1h</code>.</p><h3 id="The-Atmosphere-as-a-Consumer-Asset"><a class="docs-heading-anchor" href="#The-Atmosphere-as-a-Consumer-Asset">The Atmosphere as a Consumer Asset</a><a id="The-Atmosphere-as-a-Consumer-Asset-1"></a><a class="docs-heading-anchor-permalink" href="#The-Atmosphere-as-a-Consumer-Asset" title="Permalink"></a></h3><p>From the following table, you can see that the <code>atmosphere</code> asset is modeled as a consumer assets with a sense <span>$\geq$</span>, meaning that the sum of all inputs needs to be greater than the <code>peak_demand</code>, i.e., greater than zero in this case.</p><div><div style = "float: left;"><span>3×3 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">asset</th><th style = "text-align: left;">consumer_balance_sense</th><th style = "text-align: left;">peak_demand</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "InlineStrings.String31" style = "text-align: left;">String31</th><th title = "InlineStrings.String3" style = "text-align: left;">String3</th><th title = "Union{Missing, Float64}" style = "text-align: left;">Float64?</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">electricity_demand</td><td style = "text-align: left;">==</td><td style = "text-align: right;">80.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">heat_demand</td><td style = "text-align: left;">&gt;=</td><td style = "text-align: right;">35.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: left;">atmosphere</td><td style = "text-align: left;">&gt;=</td><td style = "text-align: right;">0.0</td></tr></tbody></table></div><p>In addition, the resolution of all the flows comming into the <code>atmosphere</code> asset is 24h, i.e., daily, meaning that the resolution of the consumer balance for this asset is also 24h:</p><p class="math-container">\[\begin{aligned}
&amp; \text{consumer\_balance}_{\text{atmosphere}, 1, 1:24}: \\
&amp; v^{\text{flow}}_{(\text{power\_plant},\text{atmosphere}),1,1:24} + v^{\text{flow}}_{(\text{chp\_backpressure},\text{atmosphere}),1,1:24} + v^{\text{flow}}_{(\text{chp\_extraction},\text{atmosphere}),1,1:24} \geq 0
\end{aligned}\]</p><p>Notice that the flows are defined as power (i.e., instantaneous value); therefore, the result of all the flows going to the <code>atmosphere</code> will represent the average CO2 emissions within the day. To compute the total daily emissions, multiply the flow by the duration (i.e., 24h) and then get the total daily value.</p><p>As explained in the <a href="../20-user-guide/20-how-to-use/#greenhouse-gas-emissions">modeling greenhouse gas emissions</a> section, you can alternatively model the <code>atmosphere</code> as a storage asset and account for the total emissions as the storage level of the asset.</p><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a>Only inputs or outputs with <a href="../20-user-guide/20-how-to-use/#coefficient-for-conversion-constraints"><code>conversion coefficient</code></a> <span>$\geq 0$</span> are considered to determine the resolution of the conversion balance constraint.</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../20-user-guide/60-structures/">« Internal Model Structures</a><a class="docs-footer-nextpage" href="../40-scientific-foundation/40-formulation/">Mathematical Formulation »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Tuesday 20 January 2026 18:49">Tuesday 20 January 2026</span>. Using Julia version 1.12.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
